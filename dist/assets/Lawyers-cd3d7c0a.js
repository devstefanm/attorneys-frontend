import{a as N,H as g,r as $,j as s,v as c,E as A,J as b,x as O,B as M}from"./index-f919451c.js";import{u as T,a as W,c as P,m as D,T as z,d as _}from"./transformData-0a63b46d.js";import{s as k,T as V}from"./setupAxios-dbc54428.js";import{C as E,G as L,L as I,A as Q,D as G,F as R,a as Y,M as q}from"./AdapterMoment-075cb260.js";import{D as v}from"./DynamicInputs-2baf6532.js";import{u as H}from"./useGetCitiesNamesQuery-fdf1906d.js";import{A as K}from"./Autocomplete-84b9c9c2.js";import{u as J,B as U}from"./useMutation-53d3e637.js";const X=({address:e,case_count:r,city:o,display_phone_numbers:i,email:u,first_name:n,last_name:m,office_name:l,phone_numbers:d})=>({address:e,numberOfCases:r,city:o,displayPhoneNumbers:i,email:u,name:`${T(n)} ${T(m)}`,officeName:l,phoneNumbers:d}),Z=async e=>{var m;const{sortBy:r="created_at",sort:o="desc",page:i=1,size:u=25}=e;let n;try{n=await k({method:"get",url:"api/lawyers-list",params:{...e,sortBy:r===""?"created_at":P(r),sort:o===""?"asc":o,page:i,size:u},withCredentials:!0}),(m=n.data.data)!=null&&m.lawyers&&(n.data.data.lawyers=n.data.data.lawyers.map(l=>X(l)))}catch{n={data:{error:500,message:"Connection problem"}}}return n},ee=e=>W(["lawyersList",e],()=>Z(e),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1}),ae=()=>"#6b7280",S=e=>{const{id:r,first_name:o,last_name:i,city:u,email:n,name:m}=e;let l="";return m&&(l=m),o&&(l=`${o} ${i??""}`),u&&(l=u),n&&(l=n),{id:r,name:l}},se=({city:e,email:r,firstName:o,lastName:i,officeName:u,phoneNumbers:n,address:m})=>{let l=null;typeof e!="string"&&(l=e.id);const d=n.filter(a=>a.length>5);return{city_id:l,email:r,first_name:o,last_name:i,office_name:u,address:m,phone_numbers:d}},y={name:"name",officeName:"officeName",email:"email",address:"address",city:"city",displayPhoneNumbers:"displayPhoneNumbers",phoneNumbers:"phoneNumbers",numberOfCases:"numberOfCases"},te=()=>{var f,x;const{t:e}=N(),{state:{sortable:{sort:r,sortBy:o},pageable:{page:i,size:u},searchable:n},dispatch:m}=g();let l={page:i,size:u,sort:r,sortBy:o};const d=n.reduce((t,j)=>{const C=D(j);return{...t,...C}},{}),{data:a,isLoading:h,refetch:p}=ee({...l,...d}),w=$.useMemo(()=>[{accessorFn:t=>t.name,id:y.name,header:()=>s.jsx("span",{children:e(`entities.${[y.name]}`)}),cell:t=>t.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:t=>t.officeName,id:y.officeName,header:()=>s.jsx("span",{children:e(`entities.${[y.officeName]}`)}),cell:t=>t.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:t=>t.email,id:y.email,header:()=>s.jsx("span",{children:e(`entities.${[y.email]}`)}),cell:t=>t.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:t=>t.displayPhoneNumbers,id:y.displayPhoneNumbers,header:()=>s.jsx("span",{children:e(`entities.${[y.phoneNumbers]}`)}),cell:t=>t.getValue(),isSortable:!0},{accessorFn:t=>t.address,id:y.address,header:()=>s.jsx("span",{children:e(`entities.${[y.address]}`)}),cell:t=>t.getValue(),isSearchable:!1,isSortable:!0},{accessorFn:t=>t.city,id:y.city,header:()=>s.jsx("span",{children:e(`entities.${[y.city]}`)}),cell:t=>t.getValue(),isSortable:!0},{accessorFn:t=>t.numberOfCases,id:y.numberOfCases,header:()=>s.jsx("span",{children:e(`entities.${[y.numberOfCases]}`)}),cell:t=>t.getValue(),isSortable:!0}],[]);return h?s.jsx(s.Fragment,{children:"Loading..."}):s.jsx(z,{columns:w,data:(f=a==null?void 0:a.data.data)==null?void 0:f.lawyers,hasSearch:!0,sort:r,sortBy:o,totalNumber:(x=a==null?void 0:a.data.data)==null?void 0:x.meta.total_number,page:i,size:u,borderKeyword:"type",updateState:m,refetch:p,mapBorderColors:ae})},re=({citiesOptions:e})=>[{name:"firstName",type:c.input,gridWidth:6,condition:!1},{name:"lastName",type:c.input,gridWidth:6,condition:!1},{name:"officeName",type:c.input,gridWidth:6,condition:!1},{name:"email",type:c.input,gridWidth:6},{name:"address",type:c.input,gridWidth:6,condition:!1},{name:"city",type:c.autocomplete,gridWidth:6,options:e},{name:"phoneNumbers",subfieldName:"phoneNumber",type:c.dynamicInputs,gridWidth:12}],oe=()=>{const{t:e}=N(),{state:{addLawyerForm:r,addLawyerAutocompleteValues:o},dispatch:i}=g(),{data:u}=H({search:o.city}),n=(d,a,h)=>(p,w)=>{switch(a){case c.input:const{value:f}=p==null?void 0:p.target;let x=f;h?(x=f.replace(h,""),i({type:b.addLawyerForm,payload:{name:d,fieldValue:x}})):i({type:b.addLawyerForm,payload:{name:d,fieldValue:x}});break;case c.checkbox:i({type:b.addLawyerForm,payload:{name:d,fieldValue:w}});break;case c.datepicker:i({type:b.addLawyerForm,payload:{name:d,fieldValue:p}});break;case c.dynamicInputs:i({type:b.addLawyerForm,payload:{name:d,fieldValue:p}});break;case c.autocomplete:i({type:b.addLawyerForm,payload:{name:d,fieldValue:w?S(w):""}});break;case c.dynamicAutocompletes:i({type:b.addLawyerForm,payload:{name:d,fieldValue:p.map(t=>S(t))}});break}},m=()=>console.log("Submitted"),l=d=>{const{name:a,type:h,gridClassName:p,formFieldClassName:w,gridWidth:f,options:x,size:t,subfieldName:j,format:C}=d;switch(h){case c.checkbox:return s.jsx(L,{className:p,item:!0,xs:f||12,children:s.jsx(R,{control:s.jsx(Y,{className:w,name:a,size:t??"small",checked:r[a],onChange:n(a,h)}),label:e(`entities.${a}`)})},a);case c.input:return s.jsx(L,{className:p,item:!0,xs:f||12,children:s.jsx(V,{fullWidth:!0,className:w,size:t??"small",label:e(`entities.${a}`),name:a,value:r[a],onChange:n(a,h,C)})},a);case c.autocomplete:return s.jsx(L,{className:p,item:!0,xs:f||12,children:s.jsx(K,{fullWidth:!0,className:w,options:x??[],getOptionLabel:F=>S(F).name,size:t??"small",value:r[a],onChange:n(a,h),renderInput:F=>s.jsx(V,{...F,label:e(`entities.${a}`),onChange:_(B=>i({type:b.addLawyerAutocompleteValues,payload:{inputName:a,inputValue:B.target.value}}),300)})})},a);case c.datepicker:return s.jsx(L,{className:p,item:!0,xs:f||12,children:s.jsx(I,{dateAdapter:Q,children:s.jsx(G,{label:e(`entities.${a}`),value:r[a],className:w,slotProps:{textField:{size:"small",fullWidth:!0},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:n(a,h)})})},a);case c.dynamicInputs:return s.jsx(L,{className:p,item:!0,xs:f||12,children:s.jsx(v,{label:e(`entities.${a}`),inputProps:{label:e(`entities.${j}`),size:"small",fullWidth:!0},values:r[a],onValuesChange:n(a,h)})},a);default:return""}};return s.jsx(A,{children:s.jsx(E,{children:s.jsx("form",{onSubmit:m,children:s.jsx(L,{container:!0,spacing:2,children:re({citiesOptions:u}).map(d=>l(d))})})})})},ie=async e=>{let r;try{r=await k({method:"post",url:"api/lawyers",data:e,withCredentials:!0})}catch{r={data:{error:500,message:"Connection problem"}}}return r},ne=(e,r)=>J(o=>ie(o),{onSuccess:o=>(r({type:b.resetLawyerFormData}),o.data.error||e(),o.data.message),onError:o=>({error:o,message:"Connection problem"})}),le=e=>{const{open:r,onClose:o}=e,{t:i}=N(),u=O(),{state:{addLawyerForm:n},dispatch:m}=g(),{mutate:l,isLoading:d,isSuccess:a}=ne(o,m);return a&&u.invalidateQueries({queryKey:["lawyersList"]}),s.jsx(A,{children:s.jsx(q,{open:r,header:i("entities.addNewLawyer"),children:s.jsx(oe,{}),onClose:o,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>l(se(n)),isLoading:d,hasCloseIconButton:!0})})},be=e=>{const{t:r}=N(),{state:{addLawyerModalOpen:o},dispatch:i}=g();return s.jsx(A,{children:s.jsxs($.Suspense,{fallback:"Loading....",children:[s.jsx(M,{className:"my-2 flex justify-end",children:s.jsx(U,{onClick:()=>i({type:b.addLawyerModalOpen,payload:!o}),children:r("entities.addNewLawyer")})}),s.jsx(te,{}),s.jsx(le,{open:o,onClose:()=>i({type:b.addLawyerModalOpen,payload:!1})})]})})};export{be as Lawyers};
