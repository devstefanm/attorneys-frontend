import{a as N,K as j,r as V,j as a,v as l,E as T,L as y,x as O,B as w}from"./index-f919451c.js";import{u as k,a as M,c as P,m as D,T as W,d as z}from"./transformData-0a63b46d.js";import{s as $,T as B}from"./setupAxios-dbc54428.js";import{C as _,G as E,L as I,A as Q,D as G,F as R,a as Y,M as q}from"./AdapterMoment-075cb260.js";import{D as v}from"./DynamicInputs-2baf6532.js";import{u as K}from"./useGetCitiesNamesQuery-fdf1906d.js";import{A as H}from"./Autocomplete-84b9c9c2.js";import{u as J,B as U}from"./useMutation-53d3e637.js";const X=({case_count:e,city:s,display_phone_numbers:r,first_name:n,last_name:u,phone_numbers:i,email:d})=>({numberOfCases:e,city:s,email:d,displayPhoneNumbers:r,name:`${k(n)} ${k(u)}`,phoneNumbers:i}),Z=async e=>{var d;const{sortBy:s="created_at",sort:r="desc",page:n=1,size:u=25}=e;let i;try{i=await $({method:"get",url:"api/executors-list",params:{...e,sortBy:s===""?"created_at":P(s),sort:r===""?"asc":r,page:n,size:u},withCredentials:!0}),(d=i.data.data)!=null&&d.executors&&(i.data.data.executors=i.data.data.executors.map(c=>X(c)))}catch{i={data:{error:500,message:"Connection problem"}}}return i},ee=e=>M(["executorsList",e],()=>Z(e),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1}),te=()=>"#6b7280",A=e=>{const{id:s,first_name:r,last_name:n,city:u,email:i,name:d}=e;let c="";return d&&(c=d),r&&(c=`${r} ${n??""}`),u&&(c=u),i&&(c=i),{id:s,name:c}},ae=({city:e,email:s,firstName:r,lastName:n,phoneNumbers:u})=>{let i=null;typeof e!="string"&&(i=e.id);const d=u.filter(c=>c.length>5);return{city_id:i,email:s,first_name:r,last_name:n,phone_numbers:d}},f={name:"name",email:"email",city:"city",displayPhoneNumbers:"displayPhoneNumbers",phoneNumbers:"phoneNumbers",numberOfCases:"numberOfCases"},se=()=>{var h,g;const{t:e}=N(),{state:{sortable:{sort:s,sortBy:r},pageable:{page:n,size:u},searchable:i},dispatch:d}=j();let c={page:n,size:u,sort:s,sortBy:r};const m=i.reduce((o,C)=>{const F=D(C);return{...o,...F}},{}),{data:t,isLoading:x,refetch:p}=ee({...c,...m}),b=V.useMemo(()=>[{accessorFn:o=>o.name,id:f.name,header:()=>a.jsx("span",{children:e(`entities.${[f.name]}`)}),cell:o=>o.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:o=>o.email,id:f.email,header:()=>a.jsx("span",{children:e(`entities.${[f.email]}`)}),cell:o=>o.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:o=>o.displayPhoneNumbers,id:f.displayPhoneNumbers,header:()=>a.jsx("span",{children:e(`entities.${[f.phoneNumbers]}`)}),cell:o=>o.getValue(),isSortable:!0},{accessorFn:o=>o.city,id:f.city,header:()=>a.jsx("span",{children:e(`entities.${[f.city]}`)}),cell:o=>o.getValue(),isSortable:!0},{accessorFn:o=>o.numberOfCases,id:f.numberOfCases,header:()=>a.jsx("span",{children:e(`entities.${[f.numberOfCases]}`)}),cell:o=>o.getValue(),isSortable:!0}],[]);return x?a.jsx(a.Fragment,{children:"Loading..."}):a.jsx(W,{columns:b,data:(h=t==null?void 0:t.data.data)==null?void 0:h.executors,hasSearch:!0,sort:s,sortBy:r,totalNumber:(g=t==null?void 0:t.data.data)==null?void 0:g.meta.total_number,page:n,size:u,borderKeyword:"type",updateState:d,refetch:p,mapBorderColors:te})},re=({citiesOptions:e})=>[{name:"firstName",type:l.input,gridWidth:6,condition:!1},{name:"lastName",type:l.input,gridWidth:6,condition:!1},{name:"email",type:l.input,gridWidth:6},{name:"city",type:l.autocomplete,gridWidth:6,options:e},{name:"phoneNumbers",subfieldName:"phoneNumber",type:l.dynamicInputs,gridWidth:12}],oe=()=>{const{t:e}=N(),{state:{addExecutorForm:s,addExecutorAutocompleteValues:r},dispatch:n}=j(),{data:u}=K({search:r.city}),i=(m,t,x)=>(p,b)=>{switch(t){case l.input:const{value:h}=p==null?void 0:p.target;let g=h;x?(g=h.replace(x,""),n({type:y.addExecutorForm,payload:{name:m,fieldValue:g}})):n({type:y.addExecutorForm,payload:{name:m,fieldValue:g}});break;case l.checkbox:n({type:y.addExecutorForm,payload:{name:m,fieldValue:b}});break;case l.datepicker:n({type:y.addExecutorForm,payload:{name:m,fieldValue:p}});break;case l.dynamicInputs:n({type:y.addExecutorForm,payload:{name:m,fieldValue:p}});break;case l.autocomplete:n({type:y.addExecutorForm,payload:{name:m,fieldValue:b?A(b):""}});break;case l.dynamicAutocompletes:n({type:y.addExecutorForm,payload:{name:m,fieldValue:p.map(o=>A(o))}});break}},d=()=>console.log("Submitted"),c=m=>{const{name:t,type:x,gridClassName:p,formFieldClassName:b,gridWidth:h,options:g,size:o,subfieldName:C,format:F}=m;switch(x){case l.checkbox:return a.jsx(E,{className:p,item:!0,xs:h||12,children:a.jsx(R,{control:a.jsx(Y,{className:b,name:t,size:o??"small",checked:s[t],onChange:i(t,x)}),label:e(`entities.${t}`)})},t);case l.input:return a.jsx(E,{className:p,item:!0,xs:h||12,children:a.jsx(B,{fullWidth:!0,className:b,size:o??"small",label:e(`entities.${t}`),name:t,value:s[t],onChange:i(t,x,F)})},t);case l.autocomplete:return a.jsx(E,{className:p,item:!0,xs:h||12,children:a.jsx(H,{fullWidth:!0,className:b,options:g??[],getOptionLabel:S=>A(S).name,size:o??"small",value:s[t],onChange:i(t,x),renderInput:S=>a.jsx(B,{...S,label:e(`entities.${t}`),onChange:z(L=>n({type:y.addExecutorAutocompleteValues,payload:{inputName:t,inputValue:L.target.value}}),300)})})},t);case l.datepicker:return a.jsx(E,{className:p,item:!0,xs:h||12,children:a.jsx(I,{dateAdapter:Q,children:a.jsx(G,{label:e(`entities.${t}`),value:s[t],className:b,slotProps:{textField:{size:"small",fullWidth:!0},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:i(t,x)})})},t);case l.dynamicInputs:return a.jsx(E,{className:p,item:!0,xs:h||12,children:a.jsx(v,{label:e(`entities.${t}`),inputProps:{label:e(`entities.${C}`),size:"small",fullWidth:!0},values:s[t],onValuesChange:i(t,x)})},t);default:return""}};return a.jsx(T,{children:a.jsx(_,{children:a.jsx("form",{onSubmit:d,children:a.jsx(E,{container:!0,spacing:2,children:re({citiesOptions:u}).map(m=>c(m))})})})})},ne=async e=>{let s;try{s=await $({method:"post",url:"api/executors",data:e,withCredentials:!0})}catch{s={data:{error:500,message:"Connection problem"}}}return s},ie=(e,s)=>J(r=>ne(r),{onSuccess:r=>(s({type:y.resetExecutorFormData}),r.data.error||e(),r.data.message),onError:r=>({error:r,message:"Connection problem"})}),ce=e=>{const{open:s,onClose:r}=e,{t:n}=N(),u=O(),{state:{addExecutorForm:i},dispatch:d}=j(),{mutate:c,isLoading:m,isSuccess:t}=ie(r,d);return t&&u.invalidateQueries({queryKey:["executorsList"]}),a.jsx(T,{children:a.jsx(q,{open:s,header:n("entities.addNewExecutor"),children:a.jsx(oe,{}),onClose:r,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>c(ae(i)),isLoading:m,hasCloseIconButton:!0})})},be=e=>{const{t:s}=N(),{state:{addExecutorModalOpen:r},dispatch:n}=j();return a.jsx(T,{children:a.jsxs(V.Suspense,{fallback:"Loading....",children:[a.jsx(w,{className:"my-2 flex justify-end",children:a.jsx(U,{onClick:()=>n({type:y.addExecutorModalOpen,payload:!r}),children:s("entities.addNewExecutor")})}),a.jsx(se,{}),a.jsx(ce,{open:r,onClose:()=>n({type:y.addExecutorModalOpen,payload:!1})})]})})};export{be as Executors};
