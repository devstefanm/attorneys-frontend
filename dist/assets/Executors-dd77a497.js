import{a as O,L as A,r as L,j as a,N as c,w as h,E as $,x as P,B as Y}from"./index-79aed4de.js";import{u as _,a as G,c as le,m as ue,T as de,C as K,G as N,D as H,L as J,b as U,e as X,d as Z,F as ee,f as te,M as ae,g as w,h as pe,i as me}from"./ConfirmationDialog-18afe8fd.js";import{s as T,T as W,u as z,B as xe}from"./setupAxios-1965d90e.js";import{u as se}from"./useGetCitiesNamesQuery-59292c71.js";import{A as oe}from"./Autocomplete-c2a1a426.js";const he=({id:t,case_count:s,city:l,display_phone_numbers:o,first_name:e,last_name:r,phone_numbers:u,email:m})=>({id:t,numberOfCases:s,city:l,email:m,displayPhoneNumbers:o,name:`${_(e)} ${_(r)}`,phoneNumbers:u}),ye=async t=>{var u;const{sortBy:s="created_at",sort:l="desc",page:o=1,size:e=25}=t;let r;try{r=await T({method:"get",url:"api/executors-list",params:{...t,sortBy:s===""?"created_at":le(s),sort:l===""?"asc":l,page:o,size:e},withCredentials:!0}),(u=r.data.data)!=null&&u.executors&&(r.data.data.executors=r.data.data.executors.map(m=>he(m)))}catch{r={data:{error:500,message:"Connection problem"}}}return r},fe=t=>G(["executorsList",t],()=>ye(t),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1}),Ee=()=>"#6b7280",M=t=>{const{id:s,first_name:l,last_name:o,city:e,email:r,name:u}=t;let m="";return u&&(m=u),l&&(m=`${l} ${o??""}`),e&&(m=e),r&&(m=r),{id:s,name:m}},be=({city:t,email:s,firstName:l,lastName:o,phoneNumbers:e})=>{let r=null;typeof t!="string"&&(r=t.id);const u=e.filter(m=>m.length>5);return{city_id:r,email:s,first_name:l,last_name:o,phone_numbers:u}},ge=({city:t,email:s,first_name:l,last_name:o,phone_numbers:e})=>({city:t!=null&&t.id?{id:t.id,name:t.name}:"",email:s||"",firstName:l,lastName:o,phoneNumbers:e&&e.length>0?e:[""]}),je=({city:t,email:s,firstName:l,lastName:o,phoneNumbers:e})=>{const r={};return t!==void 0&&(typeof t!="string"?r.city_id=t.id||null:t===""&&(r.city_id=null)),s!==void 0&&(r.email=s||null),l!==void 0&&(r.first_name=l||null),o!==void 0&&(r.last_name=o||null),e!==void 0&&(e.length>0?r.phone_numbers=e==null?void 0:e.filter(u=>u.length>5):r.phone_numbers=[""]),r},F={name:"name",email:"email",city:"city",displayPhoneNumbers:"displayPhoneNumbers",phoneNumbers:"phoneNumbers",numberOfCases:"numberOfCases"},Ce=()=>{var E,x;const{t}=O(),{state:{sortable:{sort:s,sortBy:l},pageable:{page:o,size:e},searchable:r},dispatch:u}=A();let m={page:o,size:e,sort:s,sortBy:l};const y=r.reduce((d,b)=>{const g=ue(b);return{...d,...g}},{}),{data:n,isLoading:j,refetch:f}=fe({...m,...y}),p=d=>{const{id:b}=d.original;b&&(u({type:c.editExecutorId,payload:b}),u({type:c.editExecutorModalOpen,payload:!0}))},i=L.useMemo(()=>[{accessorFn:d=>d.name,id:F.name,header:()=>a.jsx("span",{children:t(`entities.${[F.name]}`)}),cell:d=>d.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:d=>d.email,id:F.email,header:()=>a.jsx("span",{children:t(`entities.${[F.email]}`)}),cell:d=>d.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:d=>d.displayPhoneNumbers,id:F.displayPhoneNumbers,header:()=>a.jsx("span",{children:t(`entities.${[F.phoneNumbers]}`)}),cell:d=>d.getValue(),isSortable:!0},{accessorFn:d=>d.city,id:F.city,header:()=>a.jsx("span",{children:t(`entities.${[F.city]}`)}),cell:d=>d.getValue(),isSortable:!0},{accessorFn:d=>d.numberOfCases,id:F.numberOfCases,header:()=>a.jsx("span",{children:t(`entities.${[F.numberOfCases]}`)}),cell:d=>d.getValue(),isSortable:!0}],[]);return j?a.jsx(a.Fragment,{children:"Loading..."}):a.jsx(de,{columns:i,data:(E=n==null?void 0:n.data.data)==null?void 0:E.executors,hasSearch:!0,sort:s,sortBy:l,totalNumber:(x=n==null?void 0:n.data.data)==null?void 0:x.meta.total_number,page:o,size:e,borderKeyword:"type",updateState:u,refetch:f,mapBorderColors:Ee,onRowClick:p})},re=({citiesOptions:t})=>[{name:"firstName",required:!0,type:h.input,gridWidth:6,condition:!1},{name:"lastName",required:!0,type:h.input,gridWidth:6,condition:!1},{name:"email",type:h.input,gridWidth:6},{name:"city",type:h.autocomplete,gridWidth:6,options:t},{name:"phoneNumbers",subfieldName:"phoneNumber",type:h.dynamicInputs,gridWidth:12}],Ne=()=>{const{t}=O(),{state:{addExecutorForm:s,addExecutorAutocompleteValues:l},dispatch:o}=A(),{data:e}=se({search:l.city}),r=(y,n,j)=>(f,p)=>{switch(n){case h.input:const{value:i}=f==null?void 0:f.target;let E=i;j?E.match(j)&&o({type:c.addExecutorForm,payload:{name:y,fieldValue:E}}):o({type:c.addExecutorForm,payload:{name:y,fieldValue:E}});break;case h.checkbox:o({type:c.addExecutorForm,payload:{name:y,fieldValue:p}});break;case h.datepicker:o({type:c.addExecutorForm,payload:{name:y,fieldValue:f}});break;case h.dynamicInputs:o({type:c.addExecutorForm,payload:{name:y,fieldValue:f}});break;case h.autocomplete:o({type:c.addExecutorForm,payload:{name:y,fieldValue:p?M(p):""}});break;case h.dynamicAutocompletes:o({type:c.addExecutorForm,payload:{name:y,fieldValue:f.map(x=>M(x))}});break}},u=()=>console.log("Submitted"),m=y=>{const{name:n,type:j,gridClassName:f,formFieldClassName:p,gridWidth:i,options:E,size:x,subfieldName:d,format:b,required:g}=y;switch(j){case h.checkbox:return a.jsx(N,{className:f,item:!0,xs:i||12,children:a.jsx(ee,{required:g,control:a.jsx(te,{className:p,name:n,size:x??"small",checked:s[n],onChange:r(n,j)}),label:t(`entities.${n}`)})},n);case h.input:return a.jsx(N,{className:f,item:!0,xs:i||12,children:a.jsx(W,{required:g,fullWidth:!0,className:p,size:x??"small",label:t(`entities.${n}`),name:n,value:s[n],onChange:r(n,j,b)})},n);case h.autocomplete:return a.jsx(N,{className:f,item:!0,xs:i||12,children:a.jsx(oe,{fullWidth:!0,clearIcon:!1,className:p,options:E??[],getOptionLabel:C=>M(C).name,size:x??"small",value:s[n],onChange:r(n,j),renderInput:C=>a.jsx(W,{...C,required:g,label:t(`entities.${n}`),onBlur:()=>o({type:c.addExecutorAutocompleteValues,payload:{inputName:n,inputValue:""}}),onChange:Z(k=>o({type:c.addExecutorAutocompleteValues,payload:{inputName:n,inputValue:k.target.value}}),300)})})},n);case h.datepicker:return a.jsx(N,{className:f,item:!0,xs:i||12,children:a.jsx(J,{dateAdapter:U,children:a.jsx(X,{localeText:{clearButtonLabel:t("clear")},label:t(`entities.${n}`),value:s[n],className:p,slotProps:{textField:{size:"small",fullWidth:!0,required:g},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:r(n,j)})})},n);case h.dynamicInputs:return a.jsx(N,{className:f,item:!0,xs:i||12,children:a.jsx(H,{limit:n==="phoneNumbers"?4:2,label:t(`entities.${n}`),inputProps:{label:t(`entities.${d}`),size:"small",fullWidth:!0},values:s[n],onValuesChange:r(n,j)})},n);default:return""}};return a.jsx($,{children:a.jsx(K,{children:a.jsx("form",{onSubmit:u,children:a.jsx(N,{container:!0,spacing:2,children:re({citiesOptions:e}).map(y=>m(y))})})})})},Se=async t=>{let s;return s=await T({method:"post",url:"api/executors",data:t,withCredentials:!0}),s},Fe=(t,s)=>{const l=P();return z(o=>Se(o),{onSuccess:o=>(o.data.error||(s({type:c.resetExecutorFormData}),s({type:c.openSuccessSnackbar,payload:!0}),t(),l.invalidateQueries({queryKey:["executorsList"]})),o.data.message),onError:o=>{var e,r;return console.error(o),s({type:c.openErrorSnackbar,payload:!0}),{error:o,message:((r=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:r.message)||"Error has occured"}}})},ke=t=>{var b,g,C,k;const{open:s,onClose:l}=t,{t:o}=O(),{state:{addExecutorForm:e,openSuccessSnackbar:r,openErrorSnackbar:u,addExecutorModalOpen:m,editExecutorModalOpen:y},dispatch:n}=A(),{mutate:j,isLoading:f,data:p,error:i,isSuccess:E,isError:x,reset:d}=Fe(l,n);return L.useEffect(()=>{(m||y)&&E&&d()},[m,y]),a.jsxs($,{children:[a.jsx(ae,{open:s,header:o("entities.addNewExecutor"),children:a.jsx(Ne,{}),onClose:l,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>j(be(e)),isLoading:f,hasCloseIconButton:!0}),E&&(p!=null&&p.data.message)?a.jsx(w,{open:r,onClose:()=>n({type:c.openSuccessSnackbar,payload:!1}),severity:"success",content:p==null?void 0:p.data.message}):"",x&&((g=(b=i==null?void 0:i.response)==null?void 0:b.data)!=null&&g.message)?a.jsx(w,{open:u,onClose:()=>n({type:c.openErrorSnackbar,payload:!1}),severity:"error",content:(k=(C=i==null?void 0:i.response)==null?void 0:C.data)==null?void 0:k.message}):""]})},Ve=async(t,s)=>{let l;return l=await T({method:"patch",url:`api/executor/${t}`,data:s,withCredentials:!0}),l},Me=(t,s,l)=>{const o=P();return z(e=>Ve(l,e),{onSuccess:e=>(e.data.error||(s({type:c.resetExecutorFormData}),s({type:c.openSuccessSnackbar,payload:!0}),t(),o.invalidateQueries({queryKey:["executorsList"]}),o.invalidateQueries({queryKey:["executor"]})),e.data.message),onError:e=>{var r,u,m,y;return console.error(e),(u=(r=e==null?void 0:e.response)==null?void 0:r.data)!=null&&u.message&&s({type:c.openErrorSnackbar,payload:!0}),{error:e,message:((y=(m=e==null?void 0:e.response)==null?void 0:m.data)==null?void 0:y.message)||"Error has occured"}}})},Oe=async t=>{let s;if(t){try{s=await T({method:"get",url:`api/executor/${t}`,withCredentials:!0})}catch{s={data:{error:500,message:"errors.serverError"}}}return s}return{data:{error:400,message:"errors.notFound"}}},Ae=t=>G(["executor",t],()=>Oe(t),{keepPreviousData:!1,refetchOnMount:!0,refetchOnWindowFocus:!1,select(s){if(s.data.data)return ge(s.data.data)}}),Be=()=>{const{t}=O(),{state:{editExecutorForm:s,editExecutorId:l,editExecutorAutocompleteValues:o},dispatch:e}=A(),{data:r}=se({search:o.city}),{data:u,isLoading:m,isSuccess:y}=Ae(l);L.useEffect(()=>{y&&(u!=null&&u.firstName)&&e({type:c.setExecutorFormData,payload:u})},[u==null?void 0:u.firstName]);const n=(p,i,E)=>(x,d)=>{switch(i){case h.input:const{value:b}=x==null?void 0:x.target;let g=b;E?g.match(E)&&e({type:c.editExecutorForm,payload:{editName:p,fieldEditValue:g}}):e({type:c.editExecutorForm,payload:{editName:p,fieldEditValue:g}});break;case h.checkbox:e({type:c.editExecutorForm,payload:{editName:p,fieldEditValue:d}});break;case h.datepicker:e({type:c.editExecutorForm,payload:{editName:p,fieldEditValue:x}});break;case h.dynamicInputs:e({type:c.editExecutorForm,payload:{editName:p,fieldEditValue:x}});break;case h.autocomplete:e({type:c.editExecutorForm,payload:{editName:p,fieldEditValue:d?M(d):""}});break;case h.dynamicAutocompletes:e({type:c.addExecutorForm,payload:{editName:p,fieldEditValue:x.map(C=>M(C))}});break}},j=()=>console.log("Submitted"),f=p=>{const{name:i,type:E,gridClassName:x,formFieldClassName:d,gridWidth:b,size:g,subfieldName:C,format:k,options:v,required:S}=p;switch(E){case h.checkbox:return a.jsx(N,{className:x,item:!0,xs:b||12,children:a.jsx(ee,{required:S,control:a.jsx(te,{className:d,name:i,size:g??"small",checked:s[i],onChange:n(i,E)}),label:t(`entities.${i}`)})},i);case h.input:return a.jsx(N,{className:x,item:!0,xs:b||12,children:a.jsx(W,{required:S,fullWidth:!0,className:d,size:g??"small",label:t(`entities.${i}`),name:i,value:s[i],onChange:n(i,E,k)})},i);case h.autocomplete:return a.jsx(N,{className:x,item:!0,xs:b||12,children:a.jsx(oe,{fullWidth:!0,clearIcon:!1,className:d,options:v??[],getOptionLabel:B=>M(B).name,size:g??"small",value:s[i],onChange:n(i,E),renderInput:B=>a.jsx(W,{...B,required:S,label:t(`entities.${i}`),onBlur:()=>e({type:c.editExecutorAutocompleteValues,payload:{inputName:i,inputValue:""}}),onChange:Z(D=>e({type:c.editExecutorAutocompleteValues,payload:{inputName:i,inputValue:D.target.value}}),300)})})},i);case h.datepicker:return a.jsx(N,{className:x,item:!0,xs:b||12,children:a.jsx(J,{dateAdapter:U,children:a.jsx(X,{label:t(`entities.${i}`),value:s[i],className:d,slotProps:{textField:{size:"small",fullWidth:!0,required:S},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:n(i,E)})})},i);case h.dynamicInputs:return a.jsx(N,{className:x,item:!0,xs:b||12,children:a.jsx(H,{limit:i==="phoneNumbers"?4:2,label:t(`entities.${i}`),inputProps:{label:t(`entities.${C}`),size:"small",fullWidth:!0},values:s[i],onValuesChange:n(i,E)})},i);default:return""}};return m?a.jsx(Y,{className:"flex justify-center items-center h-[300px]",children:a.jsx(pe,{})}):a.jsx($,{children:a.jsx(K,{children:a.jsx("form",{onSubmit:j,children:a.jsx(N,{container:!0,spacing:2,children:re({citiesOptions:r}).map(p=>f(p))})})})})},we=async t=>{let s;return s=await T({method:"delete",url:`api/executor/${t}`,withCredentials:!0}),s},Le=(t,s,l)=>{const o=P();return z(()=>we(l),{onSuccess:e=>(e.data.error||(s({type:c.resetExecutorFormData}),s({type:c.openSuccessSnackbar,payload:!0}),t(),o.invalidateQueries({queryKey:["executorsList"]})),e.data.message),onError:e=>{var r,u,m,y;return console.error(e),(u=(r=e==null?void 0:e.response)==null?void 0:r.data)!=null&&u.message&&s({type:c.openErrorSnackbar,payload:!0}),{error:e,message:((y=(m=e==null?void 0:e.response)==null?void 0:m.data)==null?void 0:y.message)||"Error has occured"}}})},$e=t=>{var q,I,Q,R;const{open:s,onClose:l}=t,{t:o}=O(),{state:{editedExecutorFormData:e,editExecutorId:r,confirmationDialogOpen:u,openSuccessSnackbar:m,openErrorSnackbar:y,addExecutorModalOpen:n,editExecutorModalOpen:j},dispatch:f}=A(),p=()=>{f({type:c.confirmationDialogOpen,payload:!1}),l()},{mutate:i,isLoading:E,data:x,error:d,isSuccess:b,isError:g,reset:C}=Me(l,f,r),{mutate:k,isLoading:v,data:S,error:B,isSuccess:D,isError:ne,reset:ie}=Le(p,f,r);L.useEffect(()=>{(n||j)&&(b&&C(),D&&ie())},[n,j]);const ce=g||ne,V=d||B;return a.jsxs($,{children:[a.jsx(ae,{open:s,header:o("entities.editExecutor"),children:a.jsx(Be,{}),onClose:l,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>i(je(e)),isLoading:E,hasCloseIconButton:!0,extraButtonText:"delete",hasExtraButton:!0,onExtraButtonClick:()=>f({type:c.confirmationDialogOpen,payload:!u})}),a.jsx(me,{title:"entities.deleteExecutor",isLoading:v,open:u,onClose:()=>p(),onSubmit:()=>k()}),b&&(x!=null&&x.data.message)?a.jsx(w,{open:m,onClose:()=>f({type:c.openSuccessSnackbar,payload:!1}),severity:"success",content:x==null?void 0:x.data.message}):"",D&&(S!=null&&S.data.message)?a.jsx(w,{open:m,onClose:()=>f({type:c.openSuccessSnackbar,payload:!1}),severity:"success",content:S==null?void 0:S.data.message}):"",ce&&((I=(q=V==null?void 0:V.response)==null?void 0:q.data)!=null&&I.message)?a.jsx(w,{open:y,onClose:()=>f({type:c.openErrorSnackbar,payload:!1}),severity:"error",content:(R=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:R.message}):""]})},ze=t=>{const{t:s}=O(),{state:{addExecutorModalOpen:l,editExecutorModalOpen:o},dispatch:e}=A(),r=()=>{e({type:c.addExecutorModalOpen,payload:!1}),e({type:c.resetExecutorFormData})},u=()=>{e({type:c.editExecutorModalOpen,payload:!1}),e({type:c.resetExecutorFormData})};return a.jsx($,{children:a.jsxs(L.Suspense,{fallback:"Loading....",children:[a.jsx(Y,{className:"my-2 flex justify-end",children:a.jsx(xe,{onClick:()=>e({type:c.addExecutorModalOpen,payload:!l}),children:s("entities.addNewExecutor")})}),a.jsx(Ce,{}),a.jsx(ke,{open:l,onClose:r}),a.jsx($e,{open:o,onClose:u})]})})};export{ze as Executors};
