import{C as O,F as x,G as S,a as C,H as w,r as V,j as t,y as v,J as T,x as p,E as M,B as E}from"./index-a59700e2.js";import{u as D,a as L,c as z,t as P,m as Q,T as G,C as R,G as F,L as Y,A as q,b as H,d as I,F as K,e as J,M as U}from"./AdapterMoment-1f717f9b.js";import{s as B,u as X,T as W,B as Z}from"./setupAxios-41eb1db7.js";import{A as ee}from"./Autocomplete-63e30613.js";import{F as ae}from"./FilterComponent-3d347483.js";const te=({first_name:e,last_name:a,name:n,amount:s,case_number:d,excerpt_number:u,payment_date:i,posting_method:l,type:g})=>({debtorsName:n?D(n):`${e?D(e):""} ${a?D(a):""}`,amount:s,caseNumber:d,excerptNumber:u,paymentDate:i,postingMethod:l,displayType:O.t(`entities.${g}`),type:g}),se=async e=>{var l;const{sortBy:a="created_at",sort:n="desc",page:s=1,size:d=25,filter:u="payment"}=e;let i;try{i=await B({method:"get",url:"api/transactions-list",params:{...e,sortBy:a===""?"created_at":z(a),sort:n===""?"asc":n,page:s,size:d,filter:u===x.all?"":u},withCredentials:!0}),(l=i.data.data)!=null&&l.transactions&&(i.data.data.transactions=i.data.data.transactions.map(g=>te(g)))}catch{i={data:{error:500,message:"Connection problem"}}}return i},ne=e=>L(["transactionsList",e],()=>se(e),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1}),re=e=>{switch(e){case S.payment:return"#93c5fd";case S.fee:return"#fde047";case S.legal_fee:return"#f97316";case S.withdrawal:return"#22C55E";default:return"#6b7280"}},k=e=>{const{id:a,case_number:n,type:s,first_name:d,last_name:u,name:i}=e;let l="";return i&&(l=i),n&&(l=`${n} ${d?`- (${d} ${u})`:i?`- (${i})`:""}`),s&&(l=s),{id:a,name:l}},oe=({amount:e,caseNumber:a,type:n,paymentDate:s,postingMethod:d})=>{let u="",i=null,l="";return typeof a!="string"&&(u=a.name.split(" ")[0]),s&&(i=P(s)),typeof n!="string"&&(l=n.name),{amount:Number(e),case_number:u,payment_date:i,posting_method:d||null,type:l}},h={debtorsName:"debtorsName",displayType:"type",amount:"amount",postingMethod:"postingMethod",paymentDate:"paymentDate",caseNumber:"caseNumber",excerptNumber:"excerptNumber"},ie=()=>{var m,f;const{t:e}=C(),{state:{sortable:{sort:a,sortBy:n},pageable:{page:s,size:d},searchable:u,filterable:i},dispatch:l}=w();let g={page:s,size:d,sort:a,sortBy:n};const $=u.reduce((r,N)=>{const A=Q(N);return{...r,...A}},{}),{data:c,isLoading:o,refetch:b}=ne({...g,...$,filter:i}),y=V.useMemo(()=>[{accessorFn:r=>r.debtorsName,id:h.debtorsName,header:()=>t.jsx("span",{children:e(`entities.${[h.debtorsName]}`)}),cell:r=>r.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:r=>r.caseNumber,id:h.caseNumber,header:()=>t.jsx("span",{children:e(`entities.${[h.caseNumber]}`)}),cell:r=>r.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:r=>r.amount,id:h.amount,header:()=>t.jsx("span",{children:e(`entities.${[h.amount]}`)}),cell:r=>r.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:r=>r.displayType,id:h.displayType,header:()=>t.jsx("span",{children:e(`entities.${[h.displayType]}`)}),cell:r=>r.getValue(),isSortable:!0},{accessorFn:r=>r.postingMethod,id:h.postingMethod,header:()=>t.jsx("span",{children:e(`entities.${[h.postingMethod]}`)}),cell:r=>r.getValue(),isSearchable:!1,isSortable:!0},{accessorFn:r=>r.paymentDate,id:h.paymentDate,header:()=>t.jsx("span",{children:e(`entities.${[h.paymentDate]}`)}),cell:r=>r.getValue(),isSortable:!0}],[]);return o?t.jsx(t.Fragment,{children:"Loading..."}):t.jsx(G,{columns:y,data:(m=c==null?void 0:c.data.data)==null?void 0:m.transactions,hasSearch:!0,sort:a,sortBy:n,totalNumber:(f=c==null?void 0:c.data.data)==null?void 0:f.meta.total_number,page:s,size:d,borderKeyword:"type",updateState:l,refetch:b,mapBorderColors:re})},le=async e=>{let a;try{a=await B({method:"post",url:"api/transactions",data:e,withCredentials:!0})}catch{a={data:{error:500,message:"Connection problem"}}}return a},ce=(e,a)=>{const n=v();return X(s=>le(s),{onSuccess:s=>(s.data.error||(a({type:T.resetTransactionFormData}),e(),n.invalidateQueries({queryKey:["transactionsList"]})),s.data.message),onError:s=>({error:s,message:"Connection problem"})})},de=({caseNumberWithNameOptions:e,transactionTypeOptions:a})=>[{name:"caseNumber",type:p.autocomplete,gridWidth:6,options:e},{name:"type",type:p.autocomplete,gridWidth:6,options:a},{name:"amount",type:p.input,gridWidth:6,condition:!1},{name:"postingMethod",type:p.input,gridWidth:6,condition:!1},{name:"paymentDate",type:p.datepicker,gridWidth:12,condition:!1}],ue=async e=>{let a;try{a=await B({method:"get",url:"api/filter-case-numbers",params:{...e},withCredentials:!0})}catch{a={data:{error:500,message:"Connection problem"}}}return a},pe=e=>L(["caseNumbersWithNames",e],()=>ue(e),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1,select(a){return a.data.data}}),me=()=>{const{t:e}=C(),{state:{addTransactionForm:a,addTransactionAutocompleteValues:n},dispatch:s}=w(),{data:d,isFetching:u}=pe({search:n.caseNumber}),i=[{id:1,type:"fee"},{id:2,type:"legal_fee"},{id:3,type:"payment"},{id:4,type:"withdrawal"}],l=(c,o,b)=>(y,m)=>{switch(o){case p.toggle:s({type:T.addTransactionForm,payload:{name:c,fieldValue:m}});break;case p.input:const{value:f}=y==null?void 0:y.target;let r=f;b?(r=f.replace(b,""),s({type:T.addTransactionForm,payload:{name:c,fieldValue:r}})):s({type:T.addTransactionForm,payload:{name:c,fieldValue:r}});break;case p.checkbox:s({type:T.addTransactionForm,payload:{name:c,fieldValue:m}});break;case p.datepicker:s({type:T.addTransactionForm,payload:{name:c,fieldValue:y}});break;case p.autocomplete:s({type:T.addTransactionForm,payload:{name:c,fieldValue:m?k(m):""}});break}},g=()=>console.log("Submitted"),$=c=>{const{name:o,type:b,gridClassName:y,formFieldClassName:m,gridWidth:f,options:r,size:N,format:A}=c;switch(b){case p.checkbox:return t.jsx(F,{className:y,item:!0,xs:f||12,children:t.jsx(K,{control:t.jsx(J,{className:m,name:o,size:N??"small",checked:a[o],onChange:l(o,b)}),label:e(`entities.${o}`)})},o);case p.input:return t.jsx(F,{className:y,item:!0,xs:f||12,children:t.jsx(W,{fullWidth:!0,className:m,size:N??"small",label:e(`entities.${o}`),name:o,value:a[o],onChange:l(o,b,A)})},o);case p.autocomplete:return t.jsx(F,{className:y,item:!0,xs:f||12,children:t.jsx(ee,{fullWidth:!0,className:m,options:u?[]:r||[],getOptionLabel:j=>o==="type"&&j?e(`entities.${k(j).name}`):k(j).name,size:N??"small",value:a[o],onChange:l(o,b),renderInput:j=>t.jsx(W,{...j,label:e(`entities.${o}`),onChange:I(_=>s({type:T.addTransactionAutocompleteValues,payload:{inputName:o,inputValue:_.target.value}}),300)})})},o);case p.datepicker:return t.jsx(F,{className:y,item:!0,xs:f||12,children:t.jsx(Y,{dateAdapter:q,children:t.jsx(H,{label:e(`entities.${o}`),value:a[o],className:m,slotProps:{textField:{size:"small",fullWidth:!0},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:l(o,b)})})},o);default:return""}};return t.jsx(M,{children:t.jsx(R,{children:t.jsx("form",{onSubmit:g,children:t.jsx(F,{container:!0,spacing:2,children:de({caseNumberWithNameOptions:d,transactionTypeOptions:i}).map(c=>$(c))})})})})},he=e=>{const{open:a,onClose:n}=e,{t:s}=C(),{state:{addTransactionForm:d},dispatch:u}=w(),{mutate:i,isLoading:l}=ce(n,u);return t.jsx(M,{children:t.jsx(U,{open:a,header:s("entities.addNewTransaction"),children:t.jsx(me,{}),onClose:n,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>i(oe(d)),isLoading:l,hasCloseIconButton:!0})})},ye=()=>{const{state:{filterable:e},dispatch:a}=w(),{t:n}=C(),s=[{id:1,label:n("all"),value:x.all},{id:2,label:n("entities.payments"),value:x.payment},{id:3,label:n("entities.fees"),value:x.fee},{id:4,label:n("entities.legal_fees"),value:x.legal_fee},{id:5,label:n("entities.withdrawals"),value:x.withdrawal}];return t.jsx(M,{children:t.jsx(ae,{label:n("entities.transactionType"),size:"small",options:s,value:e,onChange:a})})},Ne=e=>{const{t:a}=C(),{state:{addTransactionModalOpen:n},dispatch:s}=w();return t.jsx(M,{children:t.jsxs(V.Suspense,{fallback:"Loading....",children:[t.jsxs(E,{className:"my-2 flex justify-between",children:[t.jsx(ye,{}),t.jsx(Z,{onClick:()=>s({type:T.addTransactionModalOpen,payload:!n}),children:a("entities.addNewTransaction")})]}),t.jsx(ie,{}),t.jsx(he,{open:n,onClose:()=>s({type:T.addTransactionModalOpen,payload:!1})})]})})};export{Ne as Transactions};
