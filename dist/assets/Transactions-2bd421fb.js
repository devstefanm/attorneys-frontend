import{y as v,z as x,A as M,a as w,C as S,r as V,j as s,F as g,v as p,E as $,x as O,B as z}from"./index-f919451c.js";import{u as D,a as L,c as E,t as P,m as Q,T as G,d as R}from"./transformData-0a63b46d.js";import{s as B,T as W}from"./setupAxios-dbc54428.js";import{C as Y,G as C,L as q,A as I,D as K,F as H,a as J,M as U}from"./AdapterMoment-075cb260.js";import{u as X,B as Z}from"./useMutation-53d3e637.js";import{A as ee}from"./Autocomplete-84b9c9c2.js";import{F as ae}from"./FilterComponent-c09bcbf7.js";const te=({first_name:e,last_name:a,name:t,amount:r,case_number:d,excerpt_number:u,payment_date:i,posting_method:l,type:y})=>({debtorsName:t?D(t):`${e?D(e):""} ${a?D(a):""}`,amount:r,caseNumber:d,excerptNumber:u,paymentDate:i,postingMethod:l,displayType:v.t(`entities.${y}`),type:y}),se=async e=>{var l;const{sortBy:a="created_at",sort:t="desc",page:r=1,size:d=25,filter:u="payment"}=e;let i;try{i=await B({method:"get",url:"api/transactions-list",params:{...e,sortBy:a===""?"created_at":E(a),sort:t===""?"asc":t,page:r,size:d,filter:u===x.all?"":u},withCredentials:!0}),(l=i.data.data)!=null&&l.transactions&&(i.data.data.transactions=i.data.data.transactions.map(y=>te(y)))}catch{i={data:{error:500,message:"Connection problem"}}}return i},ne=e=>L(["transactionsList",e],()=>se(e),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1}),re=e=>{switch(e){case M.payment:return"#93c5fd";case M.fee:return"#fde047";case M.legal_fee:return"#f97316";case M.withdrawal:return"#22C55E";default:return"#6b7280"}},k=e=>{const{id:a,case_number:t,type:r,first_name:d,last_name:u,name:i}=e;let l="";return i&&(l=i),t&&(l=`${t} ${d?`- (${d} ${u})`:i?`- (${i})`:""}`),r&&(l=r),{id:a,name:l}},oe=({amount:e,caseNumber:a,type:t,paymentDate:r,postingMethod:d})=>{let u="",i=null,l="";return typeof a!="string"&&(u=a.name.split(" ")[0]),r&&(i=P(r)),typeof t!="string"&&(l=t.name),{amount:Number(e),case_number:u,payment_date:i,posting_method:d||null,type:l}},h={debtorsName:"debtorsName",displayType:"type",amount:"amount",postingMethod:"postingMethod",paymentDate:"paymentDate",caseNumber:"caseNumber",excerptNumber:"excerptNumber"},ie=()=>{var m,T;const{t:e}=w(),{state:{sortable:{sort:a,sortBy:t},pageable:{page:r,size:d},searchable:u,filterable:i},dispatch:l}=S();let y={page:r,size:d,sort:a,sortBy:t};const N=u.reduce((n,j)=>{const A=Q(j);return{...n,...A}},{}),{data:c,isLoading:o,refetch:f}=ne({...y,...N,filter:i}),b=V.useMemo(()=>[{accessorFn:n=>n.debtorsName,id:h.debtorsName,header:()=>s.jsx("span",{children:e(`entities.${[h.debtorsName]}`)}),cell:n=>n.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:n=>n.caseNumber,id:h.caseNumber,header:()=>s.jsx("span",{children:e(`entities.${[h.caseNumber]}`)}),cell:n=>n.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:n=>n.amount,id:h.amount,header:()=>s.jsx("span",{children:e(`entities.${[h.amount]}`)}),cell:n=>n.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:n=>n.displayType,id:h.displayType,header:()=>s.jsx("span",{children:e(`entities.${[h.displayType]}`)}),cell:n=>n.getValue(),isSortable:!0},{accessorFn:n=>n.postingMethod,id:h.postingMethod,header:()=>s.jsx("span",{children:e(`entities.${[h.postingMethod]}`)}),cell:n=>n.getValue(),isSearchable:!1,isSortable:!0},{accessorFn:n=>n.paymentDate,id:h.paymentDate,header:()=>s.jsx("span",{children:e(`entities.${[h.paymentDate]}`)}),cell:n=>n.getValue(),isSortable:!0}],[]);return o?s.jsx(s.Fragment,{children:"Loading..."}):s.jsx(G,{columns:b,data:(m=c==null?void 0:c.data.data)==null?void 0:m.transactions,hasSearch:!0,sort:a,sortBy:t,totalNumber:(T=c==null?void 0:c.data.data)==null?void 0:T.meta.total_number,page:r,size:d,borderKeyword:"type",updateState:l,refetch:f,mapBorderColors:re})},le=async e=>{let a;try{a=await B({method:"post",url:"api/transactions",data:e,withCredentials:!0})}catch{a={data:{error:500,message:"Connection problem"}}}return a},ce=(e,a)=>X(t=>le(t),{onSuccess:t=>(a({type:g.resetTransactionFormData}),t.data.error||e(),t.data.message),onError:t=>({error:t,message:"Connection problem"})}),de=({caseNumberWithNameOptions:e,transactionTypeOptions:a})=>[{name:"caseNumber",type:p.autocomplete,gridWidth:6,options:e},{name:"type",type:p.autocomplete,gridWidth:6,options:a},{name:"amount",type:p.input,gridWidth:6,condition:!1},{name:"postingMethod",type:p.input,gridWidth:6,condition:!1},{name:"paymentDate",type:p.datepicker,gridWidth:12,condition:!1}],ue=async e=>{let a;try{a=await B({method:"get",url:"api/filter-case-numbers",params:{...e},withCredentials:!0})}catch{a={data:{error:500,message:"Connection problem"}}}return a},pe=e=>L(["caseNumbersWithNames",e],()=>ue(e),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1,select(a){return a.data.data}}),me=()=>{const{t:e}=w(),{state:{addTransactionForm:a,addTransactionAutocompleteValues:t},dispatch:r}=S(),{data:d,isFetching:u}=pe({search:t.caseNumber}),i=[{id:1,type:"fee"},{id:2,type:"legal_fee"},{id:3,type:"payment"},{id:4,type:"withdrawal"}],l=(c,o,f)=>(b,m)=>{switch(o){case p.toggle:r({type:g.addTransactionForm,payload:{name:c,fieldValue:m}});break;case p.input:const{value:T}=b==null?void 0:b.target;let n=T;f?(n=T.replace(f,""),r({type:g.addTransactionForm,payload:{name:c,fieldValue:n}})):r({type:g.addTransactionForm,payload:{name:c,fieldValue:n}});break;case p.checkbox:r({type:g.addTransactionForm,payload:{name:c,fieldValue:m}});break;case p.datepicker:r({type:g.addTransactionForm,payload:{name:c,fieldValue:b}});break;case p.autocomplete:r({type:g.addTransactionForm,payload:{name:c,fieldValue:m?k(m):""}});break}},y=()=>console.log("Submitted"),N=c=>{const{name:o,type:f,gridClassName:b,formFieldClassName:m,gridWidth:T,options:n,size:j,format:A}=c;switch(f){case p.checkbox:return s.jsx(C,{className:b,item:!0,xs:T||12,children:s.jsx(H,{control:s.jsx(J,{className:m,name:o,size:j??"small",checked:a[o],onChange:l(o,f)}),label:e(`entities.${o}`)})},o);case p.input:return s.jsx(C,{className:b,item:!0,xs:T||12,children:s.jsx(W,{fullWidth:!0,className:m,size:j??"small",label:e(`entities.${o}`),name:o,value:a[o],onChange:l(o,f,A)})},o);case p.autocomplete:return s.jsx(C,{className:b,item:!0,xs:T||12,children:s.jsx(ee,{fullWidth:!0,className:m,options:u?[]:n||[],getOptionLabel:F=>o==="type"&&F?e(`entities.${k(F).name}`):k(F).name,size:j??"small",value:a[o],onChange:l(o,f),renderInput:F=>s.jsx(W,{...F,label:e(`entities.${o}`),onChange:R(_=>r({type:g.addTransactionAutocompleteValues,payload:{inputName:o,inputValue:_.target.value}}),300)})})},o);case p.datepicker:return s.jsx(C,{className:b,item:!0,xs:T||12,children:s.jsx(q,{dateAdapter:I,children:s.jsx(K,{label:e(`entities.${o}`),value:a[o],className:m,slotProps:{textField:{size:"small",fullWidth:!0},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:l(o,f)})})},o);default:return""}};return s.jsx($,{children:s.jsx(Y,{children:s.jsx("form",{onSubmit:y,children:s.jsx(C,{container:!0,spacing:2,children:de({caseNumberWithNameOptions:d,transactionTypeOptions:i}).map(c=>N(c))})})})})},he=e=>{const{open:a,onClose:t}=e,{t:r}=w(),d=O(),{state:{addTransactionForm:u},dispatch:i}=S(),{mutate:l,isLoading:y,isSuccess:N}=ce(t,i);return N&&d.invalidateQueries({queryKey:["transactionsList"]}),s.jsx($,{children:s.jsx(U,{open:a,header:r("entities.addNewTransaction"),children:s.jsx(me,{}),onClose:t,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>l(oe(u)),isLoading:y,hasCloseIconButton:!0})})},ye=()=>{const{state:{filterable:e},dispatch:a}=S(),{t}=w(),r=[{id:1,label:t("all"),value:x.all},{id:2,label:t("entities.payments"),value:x.payment},{id:3,label:t("entities.fees"),value:x.fee},{id:4,label:t("entities.legal_fees"),value:x.legal_fee},{id:5,label:t("entities.withdrawals"),value:x.withdrawal}];return s.jsx($,{children:s.jsx(ae,{label:t("entities.transactionType"),size:"small",options:r,value:e,onChange:a})})},Fe=e=>{const{t:a}=w(),{state:{addTransactionModalOpen:t},dispatch:r}=S();return s.jsx($,{children:s.jsxs(V.Suspense,{fallback:"Loading....",children:[s.jsxs(z,{className:"my-2 flex justify-between",children:[s.jsx(ye,{}),s.jsx(Z,{onClick:()=>r({type:g.addTransactionModalOpen,payload:!t}),children:a("entities.addNewTransaction")})]}),s.jsx(ie,{}),s.jsx(he,{open:t,onClose:()=>r({type:g.addTransactionModalOpen,payload:!1})})]})})};export{Fe as Transactions};
