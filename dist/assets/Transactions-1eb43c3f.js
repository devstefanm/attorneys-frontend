import{y as v,z as x,A as M,a as S,C as w,r as W,j as s,F as g,v as m,E as $,x as O,B as z}from"./index-d5fa54d9.js";import{u as D,a as L,c as E,t as P,m as Q,T as G,d as R}from"./transformData-6202d67e.js";import{s as B,T as V}from"./setupAxios-200fdb80.js";import{C as Y,G as C,L as q,a as I,D as K,A as H,F as J,b as U,M as X,c as Z}from"./FilterComponent-13492baa.js";import{u as ee,B as ae}from"./useMutation-c59ee0e6.js";const te=({first_name:e,last_name:a,name:t,amount:n,case_number:d,excerpt_number:u,payment_date:c,posting_method:i,type:y})=>({debtorsName:t?D(t):`${e?D(e):""} ${a?D(a):""}`,amount:n,caseNumber:d,excerptNumber:u,paymentDate:c,postingMethod:i,displayType:v.t(`entities.${y}`),type:y}),se=async e=>{var i;const{sortBy:a="created_at",sort:t="asc",page:n=1,size:d=10,filter:u="payment"}=e;let c;try{c=await B({method:"get",url:"api/transactions-list",params:{...e,sortBy:a===""?"created_at":E(a),sort:t===""?"asc":t,page:n,size:d,filter:u===x.all?"":u},withCredentials:!0}),(i=c.data.data)!=null&&i.transactions&&(c.data.data.transactions=c.data.data.transactions.map(y=>te(y)))}catch{c={data:{error:500,message:"Connection problem"}}}return c},re=e=>L(["transactionsList",e],()=>se(e),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1}),ne=e=>{switch(e){case M.payment:return"#93c5fd";case M.fee:return"#fde047";case M.legal_fee:return"#f97316";case M.withdrawal:return"#22C55E";default:return"#6b7280"}},k=e=>{const{id:a,case_number:t,type:n,first_name:d,last_name:u,name:c}=e;let i="";return c&&(i=c),t&&(i=`${t} ${d?`- (${d} ${u})`:""}`),n&&(i=n),{id:a,name:i}},oe=({amount:e,caseNumber:a,type:t,paymentDate:n,postingMethod:d})=>{let u="",c=null,i="";return typeof a!="string"&&(u=a.name.split(" ")[0]),n&&(c=P(n)),typeof t!="string"&&(i=t.name),{amount:Number(e),case_number:u,payment_date:c,posting_method:d||null,type:i}},p={debtorsName:"debtorsName",displayType:"type",amount:"amount",postingMethod:"postingMethod",paymentDate:"paymentDate",caseNumber:"caseNumber",excerptNumber:"excerptNumber"},ie=()=>{var h,T;const{t:e}=S(),{state:{sortable:{sort:a,sortBy:t},pageable:{page:n,size:d},searchable:u,filterable:c},dispatch:i}=w();let y={page:n,size:d,sort:a,sortBy:t};const N=u.reduce((r,j)=>{const A=Q(j);return{...r,...A}},{}),{data:l,isLoading:o,refetch:f}=re({...y,...N,filter:c}),b=W.useMemo(()=>[{accessorFn:r=>r.debtorsName,id:p.debtorsName,header:()=>s.jsx("span",{children:e(`entities.${[p.debtorsName]}`)}),cell:r=>r.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:r=>r.caseNumber,id:p.caseNumber,header:()=>s.jsx("span",{children:e(`entities.${[p.caseNumber]}`)}),cell:r=>r.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:r=>r.excerptNumber,id:p.excerptNumber,header:()=>s.jsx("span",{children:e(`entities.${[p.excerptNumber]}`)}),cell:r=>r.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:r=>r.amount,id:p.amount,header:()=>s.jsx("span",{children:e(`entities.${[p.amount]}`)}),cell:r=>r.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:r=>r.displayType,id:p.displayType,header:()=>s.jsx("span",{children:e(`entities.${[p.displayType]}`)}),cell:r=>r.getValue(),isSortable:!0},{accessorFn:r=>r.postingMethod,id:p.postingMethod,header:()=>s.jsx("span",{children:e(`entities.${[p.postingMethod]}`)}),cell:r=>r.getValue(),isSearchable:!1,isSortable:!0},{accessorFn:r=>r.paymentDate,id:p.paymentDate,header:()=>s.jsx("span",{children:e(`entities.${[p.paymentDate]}`)}),cell:r=>r.getValue(),isSortable:!0}],[]);return o?s.jsx(s.Fragment,{children:"Loading..."}):s.jsx(G,{columns:b,data:(h=l==null?void 0:l.data.data)==null?void 0:h.transactions,hasSearch:!0,sort:a,sortBy:t,totalNumber:(T=l==null?void 0:l.data.data)==null?void 0:T.meta.total_number,page:n,size:d,borderKeyword:"type",updateState:i,refetch:f,mapBorderColors:ne})},ce=async e=>{let a;try{a=await B({method:"post",url:"api/transactions",data:e,withCredentials:!0})}catch{a={data:{error:500,message:"Connection problem"}}}return a},le=(e,a)=>ee(t=>ce(t),{onSuccess:t=>(a({type:g.resetTransactionFormData}),t.data.error||e(),t.data.message),onError:t=>({error:t,message:"Connection problem"})}),de=({caseNumberWithNameOptions:e,transactionTypeOptions:a})=>[{name:"caseNumber",type:m.autocomplete,gridWidth:6,options:e},{name:"type",type:m.autocomplete,gridWidth:6,options:a},{name:"amount",type:m.input,gridWidth:6,condition:!1},{name:"postingMethod",type:m.input,gridWidth:6,condition:!1},{name:"paymentDate",type:m.datepicker,gridWidth:12,condition:!1}],ue=async e=>{let a;try{a=await B({method:"get",url:"api/filter-case-numbers",params:{...e},withCredentials:!0})}catch{a={data:{error:500,message:"Connection problem"}}}return a},pe=e=>L(["caseNumbersWithNames",e],()=>ue(e),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1,select(a){return a.data.data}}),me=()=>{const{t:e}=S(),{state:{addTransactionForm:a,addTransactionAutocompleteValues:t},dispatch:n}=w(),{data:d,isFetching:u}=pe({search:t.caseNumber}),c=[{id:1,type:"fee"},{id:2,type:"legal_fee"},{id:3,type:"payment"},{id:4,type:"withdrawal"}],i=(l,o,f)=>(b,h)=>{switch(o){case m.toggle:n({type:g.addTransactionForm,payload:{name:l,fieldValue:h}});break;case m.input:const{value:T}=b==null?void 0:b.target;let r=T;f?(r=T.replace(f,""),n({type:g.addTransactionForm,payload:{name:l,fieldValue:r}})):n({type:g.addTransactionForm,payload:{name:l,fieldValue:r}});break;case m.checkbox:n({type:g.addTransactionForm,payload:{name:l,fieldValue:h}});break;case m.datepicker:n({type:g.addTransactionForm,payload:{name:l,fieldValue:b}});break;case m.autocomplete:n({type:g.addTransactionForm,payload:{name:l,fieldValue:h?k(h):""}});break}},y=()=>console.log("Submitted"),N=l=>{const{name:o,type:f,gridClassName:b,formFieldClassName:h,gridWidth:T,options:r,size:j,format:A}=l;switch(f){case m.checkbox:return s.jsx(C,{className:b,item:!0,xs:T||12,children:s.jsx(J,{control:s.jsx(U,{className:h,name:o,size:j??"small",checked:a[o],onChange:i(o,f)}),label:e(`entities.${o}`)})},o);case m.input:return s.jsx(C,{className:b,item:!0,xs:T||12,children:s.jsx(V,{fullWidth:!0,className:h,size:j??"small",label:e(`entities.${o}`),name:o,value:a[o],onChange:i(o,f,A)})},o);case m.autocomplete:return s.jsx(C,{className:b,item:!0,xs:T||12,children:s.jsx(H,{fullWidth:!0,className:h,options:u?[]:r||[],getOptionLabel:F=>o==="type"&&F?e(`entities.${k(F).name}`):k(F).name,size:j??"small",value:a[o],onChange:i(o,f),renderInput:F=>s.jsx(V,{...F,label:e(`entities.${o}`),onChange:R(_=>n({type:g.addTransactionAutocompleteValues,payload:{inputName:o,inputValue:_.target.value}}),300)})})},o);case m.datepicker:return s.jsx(C,{className:b,item:!0,xs:T||12,children:s.jsx(q,{dateAdapter:I,children:s.jsx(K,{label:e(`entities.${o}`),value:a[o],className:h,slotProps:{textField:{size:"small",fullWidth:!0},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:i(o,f)})})},o);default:return""}};return s.jsx($,{children:s.jsx(Y,{children:s.jsx("form",{onSubmit:y,children:s.jsx(C,{container:!0,spacing:2,children:de({caseNumberWithNameOptions:d,transactionTypeOptions:c}).map(l=>N(l))})})})})},he=e=>{const{open:a,onClose:t}=e,{t:n}=S(),d=O(),{state:{addTransactionForm:u},dispatch:c}=w(),{mutate:i,isLoading:y,isSuccess:N}=le(t,c);return N&&d.invalidateQueries({queryKey:["transactionsList"]}),s.jsx($,{children:s.jsx(X,{open:a,header:n("entities.addNewTransaction"),children:s.jsx(me,{}),onClose:t,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>i(oe(u)),isLoading:y,hasCloseIconButton:!0})})},ye=()=>{const{state:{filterable:e},dispatch:a}=w(),{t}=S(),n=[{id:1,label:t("all"),value:x.all},{id:2,label:t("entities.payments"),value:x.payment},{id:3,label:t("entities.fees"),value:x.fee},{id:4,label:t("entities.legal_fees"),value:x.legal_fee},{id:5,label:t("entities.withdrawals"),value:x.withdrawal}];return s.jsx($,{children:s.jsx(Z,{label:t("entities.transactionType"),size:"small",options:n,value:e,onChange:a})})},Ne=e=>{const{t:a}=S(),{state:{addTransactionModalOpen:t},dispatch:n}=w();return s.jsx($,{children:s.jsxs(W.Suspense,{fallback:"Loading....",children:[s.jsxs(z,{className:"my-2 flex justify-between",children:[s.jsx(ye,{}),s.jsx(ae,{onClick:()=>n({type:g.addTransactionModalOpen,payload:!t}),children:a("entities.addNewTransaction")})]}),s.jsx(ie,{}),s.jsx(he,{open:t,onClose:()=>n({type:g.addTransactionModalOpen,payload:!1})})]})})};export{Ne as Transactions};
