import{A as fe,C as L,F as Y,a as v,G as O,r as $,H as r,j as t,w as C,E as A,x as P,y as G,B as I,z as be}from"./index-8fcced7b.js";import{u as Q,a as K,c as xe,t as H,r as ge,m as oe,T as Te,C as re,G as w,L as J,b as X,e as Z,d as ie,F as le,f as ce,M as de,g as M,h as je,D as Ce,i as Se}from"./ConfirmationDialog-f41fe5ee.js";import{s as B,T as R,u as z,B as U}from"./setupAxios-fb948032.js";import{A as pe}from"./Autocomplete-ac7aa55f.js";import{F as Fe,I as Ee,b as Ne,E as ke,a as ne}from"./FileUpload-26f8fe23.js";const we=({id:s,first_name:e,last_name:o,name:a,amount:n,case_number:i,excerpt_number:d,payment_date:l,posting_method:y,type:T})=>({id:s,debtorsName:a?Q(a):`${e?Q(e):""} ${o?Q(o):""}`,amount:n,caseNumber:i,excerptNumber:d,paymentDate:l,postingMethod:y,displayType:fe.t(`entities.${T}`),type:T}),De=async s=>{var l;const{sortBy:e="created_at",sort:o="desc",page:a=1,size:n=25,filter:i="payment"}=s;let d;try{d=await B({method:"get",url:"api/transactions-list",params:{...s,sortBy:e===""?"created_at":xe(e),sort:o===""?"asc":o,page:a,size:n,filter:i===L.all?"":i},withCredentials:!0}),(l=d.data.data)!=null&&l.transactions&&(d.data.data.transactions=d.data.data.transactions.map(y=>we(y)))}catch{d={data:{error:500,message:"Connection problem"}}}return d},Oe=s=>K(["transactionsList",s],()=>De(s),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1}),Me=s=>{switch(s){case Y.payment:return"#93c5fd";case Y.fee:return"#fde047";case Y.legal_fee:return"#f97316";case Y.withdrawal:return"#22C55E";default:return"#6b7280"}},q=s=>{const{id:e,case_number:o,type:a,first_name:n,last_name:i,name:d}=s;let l="";return d&&(l=d),o&&(l=`${o} ${n?`- (${n} ${i})`:d?`- (${d})`:""}`),a&&(l=a),{id:e,name:l}},ve=({amount:s,caseNumber:e,type:o,paymentDate:a,postingMethod:n})=>{let i="",d=null,l="";return typeof e!="string"&&(i=e.name.split(" ")[0]),a&&(d=H(a)),typeof o!="string"&&(l=o.name),{amount:Number(s),case_number:i,payment_date:d,posting_method:n||null,type:l}},Ae=({amount:s,case:{id:e,case_number:o,first_name:a,last_name:n,name:i},payment_date:d,posting_method:l,type:y})=>{const h=[{id:1,type:"fee"},{id:2,type:"legal_fee"},{id:3,type:"payment"},{id:4,type:"withdrawal"}].find(c=>c.type===y);return{amount:String(s),caseNumber:{id:e,name:`${o} ${a?`- (${a} ${n})`:i?`- (${i})`:""}`},type:h,paymentDate:d?ge(d):null,postingMethod:l}},Be=({amount:s,caseNumber:e,paymentDate:o,postingMethod:a,type:n})=>{const i={};return s!==void 0&&(i.amount=Number(s)||null),e!==void 0&&(typeof e!="string"?i.case_id=e.id||null:e===""&&(i.case_id=null)),o!==void 0&&(i.payment_date=o?H(o):null),a!==void 0&&(i.posting_method=a||null),n!==void 0&&(typeof n!="string"?i.type=n.name||null:n===""&&(i.type=null)),i},D={debtorsName:"debtorsName",displayType:"type",amount:"amount",postingMethod:"postingMethod",paymentDate:"paymentDate",caseNumber:"caseNumber",excerptNumber:"excerptNumber"},Le=()=>{var b,x,S;const{t:s}=v(),{state:{sortable:{sort:e,sortBy:o},pageable:{page:a,size:n},searchable:i,filterable:d,filterableDate:l},dispatch:y}=O();let T={page:a,size:n,sort:e,sortBy:o};const h=i.reduce((u,j)=>{const E=oe(j);return{...u,...E}},{}),{data:c,isLoading:f,refetch:g}=Oe({...T,...h,filter:d,filterableDate:l?H(l):null}),m=u=>{const{id:j}=u.original;j&&(y({type:r.editTransactionId,payload:j}),y({type:r.editTransactionModalOpen,payload:!0}))};$.useEffect(()=>{var u;y({type:r.totalAmount,payload:(u=c==null?void 0:c.data.data)==null?void 0:u.total_amount})},[(b=c==null?void 0:c.data.data)==null?void 0:b.total_amount]);const p=$.useMemo(()=>[{accessorFn:u=>u.debtorsName,id:D.debtorsName,header:()=>t.jsx("span",{children:s(`entities.${[D.debtorsName]}`)}),cell:u=>u.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:u=>u.caseNumber,id:D.caseNumber,header:()=>t.jsx("span",{children:s(`entities.${[D.caseNumber]}`)}),cell:u=>u.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:u=>u.amount,id:D.amount,header:()=>t.jsx("span",{children:s(`entities.${[D.amount]}`)}),cell:u=>u.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:u=>u.displayType,id:D.displayType,header:()=>t.jsx("span",{children:s(`entities.${[D.displayType]}`)}),cell:u=>u.getValue(),isSortable:!0},{accessorFn:u=>u.paymentDate,id:D.paymentDate,header:()=>t.jsx("span",{children:s(`entities.${[D.paymentDate]}`)}),cell:u=>u.getValue(),isSortable:!0}],[]);return f?t.jsx(t.Fragment,{children:"Loading..."}):t.jsx(Te,{columns:p,data:(x=c==null?void 0:c.data.data)==null?void 0:x.transactions,hasSearch:!0,sort:e,sortBy:o,totalNumber:(S=c==null?void 0:c.data.data)==null?void 0:S.meta.total_number,page:a,size:n,borderKeyword:"type",updateState:y,refetch:g,mapBorderColors:Me,onRowClick:m})},ue=({caseNumberWithNameOptions:s,transactionTypeOptions:e})=>[{name:"caseNumber",required:!0,type:C.autocomplete,gridWidth:6,options:s},{name:"type",required:!0,type:C.autocomplete,gridWidth:6,options:e},{name:"amount",required:!0,type:C.input,gridWidth:6,condition:!1,format:/^[\d 0-9.]{0,24}$/},{name:"paymentDate",required:!0,type:C.datepicker,gridWidth:6,condition:!1}],$e=async s=>{let e;try{e=await B({method:"get",url:"api/filter-case-numbers",params:{...s},withCredentials:!0})}catch{e={data:{error:500,message:"Connection problem"}}}return e},me=s=>K(["caseNumbersWithNames",s],()=>$e(s),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1,select(e){return e.data.data}}),Ve=()=>{const{t:s}=v(),{state:{addTransactionForm:e,addTransactionAutocompleteValues:o},dispatch:a}=O(),{data:n,isFetching:i}=me({search:o.caseNumber}),d=[{id:1,type:"fee"},{id:2,type:"legal_fee"},{id:3,type:"payment"},{id:4,type:"withdrawal"}],l=(h,c,f)=>(g,m)=>{switch(c){case C.toggle:a({type:r.addTransactionForm,payload:{name:h,fieldValue:m}});break;case C.input:const{value:p}=g==null?void 0:g.target;let b=p;f?b.match(f)&&a({type:r.addTransactionForm,payload:{name:h,fieldValue:b}}):a({type:r.addTransactionForm,payload:{name:h,fieldValue:b}});break;case C.checkbox:a({type:r.addTransactionForm,payload:{name:h,fieldValue:m}});break;case C.datepicker:a({type:r.addTransactionForm,payload:{name:h,fieldValue:g}});break;case C.autocomplete:a({type:r.addTransactionForm,payload:{name:h,fieldValue:m?q(m):""}});break}},y=()=>console.log("Submitted"),T=h=>{const{name:c,type:f,gridClassName:g,formFieldClassName:m,gridWidth:p,options:b,size:x,format:S,required:u}=h;switch(f){case C.checkbox:return t.jsx(w,{className:g,item:!0,xs:p||12,children:t.jsx(le,{required:u,control:t.jsx(ce,{className:m,name:c,size:x??"small",checked:e[c],onChange:l(c,f)}),label:s(`entities.${c}`)})},c);case C.input:return t.jsx(w,{className:g,item:!0,xs:p||12,children:t.jsx(R,{required:u,fullWidth:!0,className:m,size:x??"small",label:s(`entities.${c}`),name:c,value:e[c],onChange:l(c,f,S)})},c);case C.autocomplete:return t.jsx(w,{className:g,item:!0,xs:p||12,children:t.jsx(pe,{fullWidth:!0,clearIcon:!1,className:m,options:i?[]:b||[],getOptionLabel:j=>c==="type"&&j?s(`entities.${q(j).name}`):q(j).name,size:x??"small",value:e[c],onChange:l(c,f),renderInput:j=>t.jsx(R,{...j,required:u,label:s(`entities.${c}`),onBlur:()=>a({type:r.addTransactionAutocompleteValues,payload:{inputName:c,inputValue:""}}),onChange:ie(E=>a({type:r.addTransactionAutocompleteValues,payload:{inputName:c,inputValue:E.target.value}}),300)})})},c);case C.datepicker:return t.jsx(w,{className:g,item:!0,xs:p||12,children:t.jsx(J,{dateAdapter:X,children:t.jsx(Z,{localeText:{clearButtonLabel:s("clear")},label:s(`entities.${c}`),value:e[c],className:m,slotProps:{textField:{size:"small",fullWidth:!0,required:u},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:l(c,f)})})},c);default:return""}};return t.jsx(A,{children:t.jsx(re,{children:t.jsx("form",{onSubmit:y,children:t.jsx(w,{container:!0,spacing:2,children:ue({caseNumberWithNameOptions:n,transactionTypeOptions:d}).map(h=>T(h))})})})})},We=async s=>{let e;return e=await B({method:"post",url:"api/transactions",data:s,withCredentials:!0}),e},qe=(s,e)=>{const o=P();return z(a=>We(a),{onSuccess:a=>(a.data.error||(e({type:r.resetTransactionFormData}),e({type:r.openSuccessSnackbar,payload:!0}),s(),o.invalidateQueries({queryKey:["transactionsList"]})),a.data.message),onError:a=>{var n,i;return console.error(a),e({type:r.openErrorSnackbar,payload:!0}),{error:a,message:((i=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:i.message)||"Error has occured"}}})},_e=s=>{var S,u,j,E;const{open:e,onClose:o}=s,{t:a}=v(),{state:{addTransactionForm:n,openSuccessSnackbar:i,openErrorSnackbar:d,addTransactionModalOpen:l,editTransactionModalOpen:y,importTransactionsDialogOpen:T},dispatch:h}=O(),{mutate:c,isLoading:f,data:g,error:m,isSuccess:p,isError:b,reset:x}=qe(o,h);return $.useEffect(()=>{(l||y||T)&&p&&x()},[l,y,T]),t.jsxs(A,{children:[t.jsx(de,{open:e,header:a("entities.addNewTransaction"),children:t.jsx(Ve,{}),onClose:o,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>c(ve(n)),isLoading:f,hasCloseIconButton:!0}),p&&(g!=null&&g.data.message)?t.jsx(M,{open:i,onClose:()=>h({type:r.openSuccessSnackbar,payload:!1}),severity:"success",content:g==null?void 0:g.data.message}):"",b&&((u=(S=m==null?void 0:m.response)==null?void 0:S.data)!=null&&u.message)?t.jsx(M,{open:d,onClose:()=>h({type:r.openErrorSnackbar,payload:!1}),severity:"error",content:(E=(j=m==null?void 0:m.response)==null?void 0:j.data)==null?void 0:E.message}):""]})},ze=()=>{const{state:{filterable:s,pageable:e},dispatch:o}=O(),{t:a}=v(),n=[{id:1,label:a("all"),value:L.all},{id:2,label:a("entities.payments"),value:L.payment},{id:3,label:a("entities.fees"),value:L.fee},{id:4,label:a("entities.legal_fees"),value:L.legal_fee},{id:5,label:a("entities.withdrawals"),value:L.withdrawal}],i=d=>{o({type:G.filterable,payload:d}),o({type:G.pageable,payload:{...e,page:1}})};return t.jsx(A,{children:t.jsx(Fe,{label:a("entities.transactionType"),size:"small",options:n,value:s,onChange:i})})},Ye=async(s,e)=>{let o;return o=await B({method:"patch",url:`api/transaction/${s}`,data:e,withCredentials:!0}),o},Ie=(s,e,o)=>{const a=P();return z(n=>Ye(o,n),{onSuccess:n=>(n.data.error||(e({type:r.resetTransactionFormData}),e({type:r.openSuccessSnackbar,payload:!0}),s(),a.invalidateQueries({queryKey:["transactionsList"]}),a.invalidateQueries({queryKey:["transaction"]})),n.data.message),onError:n=>{var i,d,l,y;return console.error(n),(d=(i=n==null?void 0:n.response)==null?void 0:i.data)!=null&&d.message&&e({type:r.openErrorSnackbar,payload:!0}),{error:n,message:((y=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:y.message)||"Error has occured"}}})},Re=async s=>{let e;if(s){try{e=await B({method:"get",url:`api/transaction/${s}`,withCredentials:!0})}catch{e={data:{error:500,message:"errors.serverError"}}}return e}return{data:{error:400,message:"errors.notFound"}}},Pe=s=>K(["transaction",s],()=>Re(s),{keepPreviousData:!1,refetchOnMount:!0,refetchOnWindowFocus:!1,select(e){if(e.data.data)return Ae(e.data.data)}}),Qe=()=>{const{t:s}=v(),{state:{editTransactionForm:e,editTransactionId:o,editTransactionAutocompleteValues:a},dispatch:n}=O(),{data:i,isFetching:d}=me({search:a.caseNumber}),l=[{id:1,type:"fee"},{id:2,type:"legal_fee"},{id:3,type:"payment"},{id:4,type:"withdrawal"}],{data:y,isLoading:T,isSuccess:h}=Pe(o);$.useEffect(()=>{h&&(y!=null&&y.caseNumber)&&n({type:r.setTransactionFormData,payload:y})},[y==null?void 0:y.caseNumber]);const c=(m,p,b)=>(x,S)=>{switch(p){case C.input:const{value:u}=x==null?void 0:x.target;let j=u;b?j.match(b)&&n({type:r.editTransactionForm,payload:{editName:m,fieldEditValue:j}}):n({type:r.editTransactionForm,payload:{editName:m,fieldEditValue:j}});break;case C.checkbox:n({type:r.editTransactionForm,payload:{editName:m,fieldEditValue:S}});break;case C.datepicker:n({type:r.editTransactionForm,payload:{editName:m,fieldEditValue:x}});break;case C.autocomplete:n({type:r.editTransactionForm,payload:{editName:m,fieldEditValue:S?q(S):""}});break;case C.dynamicInputs:n({type:r.editTransactionForm,payload:{editName:m,fieldEditValue:x}});break}},f=()=>console.log("Submitted"),g=m=>{const{name:p,type:b,gridClassName:x,formFieldClassName:S,gridWidth:u,size:j,subfieldName:E,format:V,options:N,required:k}=m;switch(b){case C.checkbox:return t.jsx(w,{className:x,item:!0,xs:u||12,children:t.jsx(le,{required:k,control:t.jsx(ce,{className:S,name:p,size:j??"small",checked:e[p],onChange:c(p,b)}),label:s(`entities.${p}`)})},p);case C.input:return t.jsx(w,{className:x,item:!0,xs:u||12,children:t.jsx(R,{required:k,fullWidth:!0,className:S,size:j??"small",label:s(`entities.${p}`),name:p,value:e[p],onChange:c(p,b,V)})},p);case C.autocomplete:return t.jsx(w,{className:x,item:!0,xs:u||12,children:t.jsx(pe,{fullWidth:!0,clearIcon:!1,className:S,options:d?[]:N||[],getOptionLabel:F=>p==="type"&&F?s(`entities.${q(F).name}`):q(F).name,size:j??"small",value:e[p],onChange:c(p,b),renderInput:F=>t.jsx(R,{...F,required:k,label:s(`entities.${p}`),onBlur:()=>n({type:r.editTransactionAutocompleteValues,payload:{inputName:p,inputValue:""}}),onChange:ie(_=>n({type:r.editTransactionAutocompleteValues,payload:{inputName:p,inputValue:_.target.value}}),300)})})},p);case C.datepicker:return t.jsx(w,{className:x,item:!0,xs:u||12,children:t.jsx(J,{dateAdapter:X,children:t.jsx(Z,{localeText:{clearButtonLabel:s("clear")},label:s(`entities.${p}`),value:e[p],className:S,slotProps:{textField:{size:"small",fullWidth:!0,required:k},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:c(p,b)})})},p);case C.dynamicInputs:return t.jsx(w,{className:x,item:!0,xs:u||12,children:t.jsx(Ce,{limit:p==="phoneNumbers"?4:2,label:s(`entities.${p}`),inputProps:{label:s(`entities.${E}`),size:"small",fullWidth:!0},values:e[p],onValuesChange:c(p,b)})},p);default:return""}};return T?t.jsx(I,{className:"flex justify-center items-center h-[300px]",children:t.jsx(je,{})}):t.jsx(A,{children:t.jsx(re,{children:t.jsx("form",{onSubmit:f,children:t.jsx(w,{container:!0,spacing:2,children:ue({caseNumberWithNameOptions:i,transactionTypeOptions:l}).map(m=>g(m))})})})})},Ue=async s=>{let e;return e=await B({method:"delete",url:`api/transaction/${s}`,withCredentials:!0}),e},Ge=(s,e,o)=>{const a=P();return z(()=>Ue(o),{onSuccess:n=>(n.data.error||(e({type:r.resetTransactionFormData}),e({type:r.openSuccessSnackbar,payload:!0}),s(),a.invalidateQueries({queryKey:["transactionsList"]})),n.data.message),onError:n=>{var i,d,l,y;return console.error(n),(d=(i=n==null?void 0:n.response)==null?void 0:i.data)!=null&&d.message&&e({type:r.openErrorSnackbar,payload:!0}),{error:n,message:((y=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:y.message)||"Error has occured"}}})},Ke=s=>{var ee,ae,te,se;const{open:e,onClose:o}=s,{t:a}=v(),{state:{editedTransactionFormData:n,editTransactionId:i,confirmationDialogOpen:d,openSuccessSnackbar:l,openErrorSnackbar:y,addTransactionModalOpen:T,editTransactionModalOpen:h,importTransactionsDialogOpen:c},dispatch:f}=O(),g=()=>{f({type:r.confirmationDialogOpen,payload:!1}),o()},{mutate:m,isLoading:p,data:b,error:x,isSuccess:S,isError:u,reset:j}=Ie(o,f,i),{mutate:E,isLoading:V,data:N,error:k,isSuccess:F,isError:_,reset:ye}=Ge(g,f,i);$.useEffect(()=>{(T||h||c)&&(S&&j(),F&&ye())},[T,h,c]);const he=u||_,W=x||k;return t.jsxs(A,{children:[t.jsx(de,{open:e,header:a("entities.editTransaction"),children:t.jsx(Qe,{}),onClose:o,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>m(Be(n)),isLoading:p,hasCloseIconButton:!0,extraButtonText:"delete",hasExtraButton:!0,onExtraButtonClick:()=>f({type:r.confirmationDialogOpen,payload:!d})}),t.jsx(Se,{title:"entities.deleteTransaction",isLoading:V,open:d,onClose:()=>g(),onSubmit:()=>E()}),S&&(b!=null&&b.data.message)?t.jsx(M,{open:l,onClose:()=>f({type:r.openSuccessSnackbar,payload:!1}),severity:"success",content:b==null?void 0:b.data.message}):"",F&&(N!=null&&N.data.message)?t.jsx(M,{open:l,onClose:()=>f({type:r.openSuccessSnackbar,payload:!1}),severity:"success",content:N==null?void 0:N.data.message}):"",he&&((ae=(ee=W==null?void 0:W.response)==null?void 0:ee.data)!=null&&ae.message)?t.jsx(M,{open:y,onClose:()=>f({type:r.openErrorSnackbar,payload:!1}),severity:"error",content:(se=(te=W==null?void 0:W.response)==null?void 0:te.data)==null?void 0:se.message}):""]})},He=async s=>{let e;const o=new FormData;return o.append("file",s),e=await B({method:"post",url:"api/import-transactions-list",data:o,withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}}),e},Je=(s,e)=>{const o=P();return z(a=>He(a),{onSuccess:a=>(a.data.error||(e({type:r.openSuccessSnackbar,payload:!0}),e({type:r.resetTransactionFormData}),o.invalidateQueries({queryKey:["transactionsList"]}),setTimeout(()=>{s()},1500)),a.data.message),onError:a=>{var n,i,d,l;return console.error(a),(i=(n=a==null?void 0:a.response)==null?void 0:n.data)!=null&&i.message&&e({type:r.openErrorSnackbar,payload:!0}),{error:a,message:((l=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:l.message)||"Error has occured"}}})},Xe=s=>{var g,m,p,b;const{open:e,onClose:o}=s,{state:{transactionsFileForUpload:a,openSuccessSnackbar:n,openErrorSnackbar:i},dispatch:d}=O(),{isLoading:l,mutateAsync:y,data:T,error:h,isError:c,isSuccess:f}=Je(o,d);return t.jsxs(A,{children:[t.jsx(Ee,{title:"entities.importTransactions",open:e,onClose:o,uploadComponent:t.jsx(Ne,{onFileUpload:x=>d({type:r.transactionsFileForUpload,payload:x}),onFileDelete:()=>d({type:r.resetTransactionFormData})}),isLoading:l,file:a,onSubmitFile:()=>a&&y(a)}),f&&(T!=null&&T.data.message)?t.jsx(M,{open:n,onClose:()=>d({type:r.openSuccessSnackbar,payload:!1}),severity:"success",content:T==null?void 0:T.data.message}):"",c&&((m=(g=h==null?void 0:h.response)==null?void 0:g.data)!=null&&m.message)?t.jsx(M,{open:i,onClose:()=>d({type:r.openErrorSnackbar,payload:!1}),severity:"error",content:(b=(p=h==null?void 0:h.response)==null?void 0:p.data)==null?void 0:b.message}):""]})},Ze=()=>{const{state:{filterableDate:s,pageable:e},dispatch:o}=O(),{t:a}=v(),n=i=>{o({type:r.filterableDate,payload:i}),o({type:G.pageable,payload:{...e,page:1}})};return t.jsx(A,{children:t.jsx(J,{dateAdapter:X,children:t.jsx(Z,{localeText:{clearButtonLabel:a("clear")},label:a("entities.transactionsYoungerThan"),value:s,slotProps:{textField:{size:"small",fullWidth:!0},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:n})})})},ea=async s=>{const{filter:e="active"}=s;let o;if(o=await B({method:"post",url:"api/export-transactions-list",data:{...s,filter:e===L.all?"":e},withCredentials:!0}),!o.data.error){const a=o.data.data;if(a)if(typeof a=="object"&&a.type==="Buffer"&&Array.isArray(a.data)){const n=new Uint8Array(a.data);return new Blob([n])}else return new Blob([a])}},aa=s=>z(e=>ea(e),{onError:e=>{var o,a,n,i;return console.error(e),(a=(o=e==null?void 0:e.response)==null?void 0:o.data)!=null&&a.message&&s({type:r.openErrorSnackbar,payload:!0}),{error:e,message:((i=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:i.message)||"Error has occured"}}}),ta=s=>{var j,E,V,N;const{open:e,onClose:o}=s,{t:a}=v(),{state:{searchable:n,filterable:i,filterableDate:d,downloadFile:l,exportFileType:y,openSuccessSnackbar:T,openErrorSnackbar:h,totalAmount:c},dispatch:f}=O(),g=n.reduce((k,F)=>{const _=oe(F);return{...k,..._}},{}),{data:m,isLoading:p,mutateAsync:b,error:x,isSuccess:S,isError:u}=aa(f);return $.useEffect(()=>{if(!p&&m){const k=window.URL.createObjectURL(m),F=document.createElement("a");F.href=k,F.download=`${a("entities.transactions")} - ${be().format("YYYY.MM.DD HH-mm")}${y==="excel"?".xlsx":".csv"}`,document.body.appendChild(F),F.click(),window.URL.revokeObjectURL(k),S&&(f({type:r.openSuccessSnackbar,payload:!0}),setTimeout(()=>{o()},1500))}},[p,m]),t.jsxs(A,{children:[t.jsx(ke,{title:"entities.exportTransactions",open:e,onClose:o,exportCSVButton:t.jsx(ne,{text:"exportCSV",isLoading:p,disabled:!c,onClick:async()=>{f({type:r.exportFileType,payload:"csv"}),f({type:r.downloadFile,payload:!0}),await b({...g,filter:i,filterableDate:d,fileType:"csv",downloadFile:l})}}),exportExcelButton:t.jsx(ne,{text:"exportExcel",isLoading:p,disabled:!c,onClick:async()=>{f({type:r.exportFileType,payload:"excel"}),f({type:r.downloadFile,payload:!0}),await b({...g,filter:i,filterableDate:d,fileType:"excel",downloadFile:l})}})}),S&&m?t.jsx(M,{open:T,onClose:()=>f({type:r.openSuccessSnackbar,payload:!1}),severity:"success",content:"messages.fileExportSuccess"}):"",u&&((E=(j=x==null?void 0:x.response)==null?void 0:j.data)!=null&&E.message)?t.jsx(M,{open:h,onClose:()=>f({type:r.openErrorSnackbar,payload:!1}),severity:"error",content:(N=(V=x==null?void 0:x.response)==null?void 0:V.data)==null?void 0:N.message}):""]})},la=s=>{const{t:e}=v(),{state:{addTransactionModalOpen:o,editTransactionModalOpen:a,totalAmount:n,importTransactionsDialogOpen:i,exportTransactionsDialogOpen:d},dispatch:l}=O(),y=()=>{l({type:r.addTransactionModalOpen,payload:!1}),l({type:r.resetTransactionFormData})},T=()=>{l({type:r.editTransactionModalOpen,payload:!1}),l({type:r.resetTransactionFormData})},h=()=>{l({type:r.importTransactionsDialogOpen,payload:!1}),l({type:r.resetTransactionFormData})},c=()=>{l({type:r.exportTransactionsDialogOpen,payload:!1}),l({type:r.resetTransactionFormData})};return t.jsx(A,{children:t.jsxs($.Suspense,{fallback:"Loading....",children:[t.jsxs(I,{className:"my-2 flex justify-between items-baseline",children:[t.jsxs(t.Fragment,{children:[t.jsxs(I,{className:"grid grid-flow-col gap-2",children:[t.jsx(ze,{}),t.jsx(Ze,{})]}),n?t.jsxs("span",{className:"text-sm",children:[e("entities.totalAmount"),": ",n]}):""]}),t.jsxs(I,{children:[t.jsx(U,{color:"success",onClick:()=>l({type:r.importTransactionsDialogOpen,payload:!i}),children:e("entities.importTransactions")}),t.jsx(U,{color:"info",onClick:()=>l({type:r.exportTransactionsDialogOpen,payload:!d}),children:e("entities.exportTransactions")}),t.jsx(U,{onClick:()=>l({type:r.addTransactionModalOpen,payload:!o}),children:e("entities.addNewTransaction")})]})]}),t.jsx(Le,{}),t.jsx(_e,{open:o,onClose:y}),t.jsx(Ke,{open:a,onClose:T}),i?t.jsx(Xe,{open:i,onClose:h}):"",d?t.jsx(ta,{open:d,onClose:c}):""]})})};export{la as Transactions};
