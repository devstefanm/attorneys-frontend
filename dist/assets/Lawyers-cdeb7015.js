import{a as V,J as M,r as A,j as t,K as c,w as f,E as $,x as P,B as Y}from"./index-519f3ca8.js";import{u as _,a as K,c as de,m as ce,T as ue,C as G,G as C,D as H,L as J,b as U,e as X,d as Z,F as ee,f as ae,M as te,g as B,h as pe,i as me}from"./ConfirmationDialog-13a70a71.js";import{s as T,T as W,u as z,B as ye}from"./setupAxios-8cb3d16d.js";import{u as se}from"./useGetCitiesNamesQuery-62190486.js";import{A as re}from"./Autocomplete-41d87e66.js";const he=({id:a,address:s,case_count:u,city:i,display_phone_numbers:e,email:l,first_name:p,last_name:d,office_name:m,phone_numbers:r})=>({id:a,address:s,numberOfCases:u,city:i,displayPhoneNumbers:e,email:l,name:`${_(p)} ${_(d)}`,officeName:m,phoneNumbers:r}),fe=async a=>{var p;const{sortBy:s="created_at",sort:u="desc",page:i=1,size:e=25}=a;let l;try{l=await T({method:"get",url:"api/lawyers-list",params:{...a,sortBy:s===""?"created_at":de(s),sort:u===""?"asc":u,page:i,size:e},withCredentials:!0}),(p=l.data.data)!=null&&p.lawyers&&(l.data.data.lawyers=l.data.data.lawyers.map(d=>he(d)))}catch{l={data:{error:500,message:"Connection problem"}}}return l},we=a=>K(["lawyersList",a],()=>fe(a),{keepPreviousData:!0,refetchOnMount:!1,refetchOnWindowFocus:!1}),be=()=>"#6b7280",k=a=>{const{id:s,first_name:u,last_name:i,city:e,email:l,name:p}=a;let d="";return p&&(d=p),u&&(d=`${u} ${i??""}`),e&&(d=e),l&&(d=l),{id:s,name:d}},ge=({city:a,email:s,firstName:u,lastName:i,officeName:e,phoneNumbers:l,address:p})=>{let d=null;typeof a!="string"&&(d=a.id);const m=l.filter(r=>r.length>5);return{city_id:d,email:s,first_name:u,last_name:i,office_name:e,address:p,phone_numbers:m}},xe=({city:a,email:s,first_name:u,last_name:i,phone_numbers:e,address:l,office_name:p})=>({city:a!=null&&a.id?{id:a.id,name:a.name}:"",email:s||"",firstName:u,lastName:i,address:l||"",officeName:p,phoneNumbers:e&&e.length>0?e:[""]}),Le=({city:a,email:s,firstName:u,lastName:i,phoneNumbers:e,address:l,officeName:p})=>{const d={};return a!==void 0&&(typeof a!="string"?d.city_id=a.id||null:a===""&&(d.city_id=null)),s!==void 0&&(d.email=s||null),u!==void 0&&(d.first_name=u||null),i!==void 0&&(d.last_name=i||null),l!==void 0&&(d.address=l||null),p!==void 0&&(d.office_name=p||null),e!==void 0&&(e.length>0?d.phone_numbers=e==null?void 0:e.filter(m=>m.length>5):d.phone_numbers=[""]),d},N={name:"name",officeName:"officeName",email:"email",address:"address",city:"city",displayPhoneNumbers:"displayPhoneNumbers",phoneNumbers:"phoneNumbers",numberOfCases:"numberOfCases"},Ne=()=>{var b,h;const{t:a}=V(),{state:{sortable:{sort:s,sortBy:u},pageable:{page:i,size:e},searchable:l},dispatch:p}=M();let d={page:i,size:e,sort:s,sortBy:u};const m=l.reduce((o,g)=>{const x=ce(g);return{...o,...x}},{}),{data:r,isLoading:L,refetch:w}=we({...d,...m}),y=o=>{const{id:g}=o.original;g&&(p({type:c.editLawyerId,payload:g}),p({type:c.editLawyerModalOpen,payload:!0}))},n=A.useMemo(()=>[{accessorFn:o=>o.name,id:N.name,header:()=>t.jsx("span",{children:a(`entities.${[N.name]}`)}),cell:o=>o.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:o=>o.officeName,id:N.officeName,header:()=>t.jsx("span",{children:a(`entities.${[N.officeName]}`)}),cell:o=>o.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:o=>o.email,id:N.email,header:()=>t.jsx("span",{children:a(`entities.${[N.email]}`)}),cell:o=>o.getValue(),isSearchable:!0,isSortable:!0},{accessorFn:o=>o.displayPhoneNumbers,id:N.displayPhoneNumbers,header:()=>t.jsx("span",{children:a(`entities.${[N.phoneNumbers]}`)}),cell:o=>o.getValue(),isSortable:!0},{accessorFn:o=>o.address,id:N.address,header:()=>t.jsx("span",{children:a(`entities.${[N.address]}`)}),cell:o=>o.getValue(),isSearchable:!1,isSortable:!0},{accessorFn:o=>o.city,id:N.city,header:()=>t.jsx("span",{children:a(`entities.${[N.city]}`)}),cell:o=>o.getValue(),isSortable:!0},{accessorFn:o=>o.numberOfCases,id:N.numberOfCases,header:()=>t.jsx("span",{children:a(`entities.${[N.numberOfCases]}`)}),cell:o=>o.getValue(),isSortable:!0}],[]);return L?t.jsx(t.Fragment,{children:"Loading..."}):t.jsx(ue,{columns:n,data:(b=r==null?void 0:r.data.data)==null?void 0:b.lawyers,hasSearch:!0,sort:s,sortBy:u,totalNumber:(h=r==null?void 0:r.data.data)==null?void 0:h.meta.total_number,page:i,size:e,borderKeyword:"type",updateState:p,refetch:w,mapBorderColors:be,onRowClick:y})},ie=({citiesOptions:a})=>[{name:"firstName",required:!0,type:f.input,gridWidth:6,condition:!1},{name:"lastName",required:!0,type:f.input,gridWidth:6,condition:!1},{name:"officeName",type:f.input,gridWidth:6,condition:!1},{name:"email",type:f.input,gridWidth:6},{name:"address",type:f.input,gridWidth:6,condition:!1},{name:"city",type:f.autocomplete,gridWidth:6,options:a},{name:"phoneNumbers",subfieldName:"phoneNumber",type:f.dynamicInputs,gridWidth:12}],je=()=>{const{t:a}=V(),{state:{addLawyerForm:s,addLawyerAutocompleteValues:u},dispatch:i}=M(),{data:e}=se({search:u.city}),l=(m,r,L)=>(w,y)=>{switch(r){case f.input:const{value:n}=w==null?void 0:w.target;let b=n;L?b.match(L)&&i({type:c.addLawyerForm,payload:{name:m,fieldValue:b}}):i({type:c.addLawyerForm,payload:{name:m,fieldValue:b}});break;case f.checkbox:i({type:c.addLawyerForm,payload:{name:m,fieldValue:y}});break;case f.datepicker:i({type:c.addLawyerForm,payload:{name:m,fieldValue:w}});break;case f.dynamicInputs:i({type:c.addLawyerForm,payload:{name:m,fieldValue:w}});break;case f.autocomplete:i({type:c.addLawyerForm,payload:{name:m,fieldValue:y?k(y):""}});break;case f.dynamicAutocompletes:i({type:c.addLawyerForm,payload:{name:m,fieldValue:w.map(h=>k(h))}});break}},p=()=>console.log("Submitted"),d=m=>{const{name:r,type:L,gridClassName:w,formFieldClassName:y,gridWidth:n,options:b,size:h,subfieldName:o,format:g,required:x}=m;switch(L){case f.checkbox:return t.jsx(C,{className:w,item:!0,xs:n||12,children:t.jsx(ee,{required:x,control:t.jsx(ae,{className:y,name:r,size:h??"small",checked:s[r],onChange:l(r,L)}),label:a(`entities.${r}`)})},r);case f.input:return t.jsx(C,{className:w,item:!0,xs:n||12,children:t.jsx(W,{required:x,fullWidth:!0,className:y,size:h??"small",label:a(`entities.${r}`),name:r,value:s[r],onChange:l(r,L,g)})},r);case f.autocomplete:return t.jsx(C,{className:w,item:!0,xs:n||12,children:t.jsx(re,{fullWidth:!0,clearIcon:!1,className:y,options:b??[],getOptionLabel:j=>k(j).name,size:h??"small",value:s[r],onChange:l(r,L),renderInput:j=>t.jsx(W,{...j,required:x,label:a(`entities.${r}`),onBlur:()=>i({type:c.addLawyerAutocompleteValues,payload:{inputName:r,inputValue:""}}),onChange:Z(F=>i({type:c.addLawyerAutocompleteValues,payload:{inputName:r,inputValue:F.target.value}}),300)})})},r);case f.datepicker:return t.jsx(C,{className:w,item:!0,xs:n||12,children:t.jsx(J,{dateAdapter:U,children:t.jsx(X,{localeText:{clearButtonLabel:a("clear")},label:a(`entities.${r}`),value:s[r],className:y,slotProps:{textField:{size:"small",fullWidth:!0,required:x},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:l(r,L)})})},r);case f.dynamicInputs:return t.jsx(C,{className:w,item:!0,xs:n||12,children:t.jsx(H,{limit:r==="phoneNumbers"?4:2,label:a(`entities.${r}`),inputProps:{label:a(`entities.${o}`),size:"small",fullWidth:!0},values:s[r],onValuesChange:l(r,L)})},r);default:return""}};return t.jsx($,{children:t.jsx(G,{children:t.jsx("form",{onSubmit:p,children:t.jsx(C,{container:!0,spacing:2,children:ie({citiesOptions:e}).map(m=>d(m))})})})})},Ce=async a=>{let s;return s=await T({method:"post",url:"api/lawyers",data:a,withCredentials:!0}),s},Se=(a,s)=>{const u=P();return z(i=>Ce(i),{onSuccess:i=>(i.data.error||(s({type:c.resetLawyerFormData}),i.data.message&&s({type:c.openSuccessSnackbar,payload:!0}),a(),u.invalidateQueries({queryKey:["lawyersList"]})),i.data.message),onError:i=>{var e,l;return console.error(i),s({type:c.openErrorSnackbar,payload:!0}),{error:i,message:((l=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:l.message)||"Error has occured"}}})},Fe=a=>{var g,x,j,F;const{open:s,onClose:u}=a,{t:i}=V(),{state:{addLawyerForm:e,openSuccessSnackbar:l,openErrorSnackbar:p,addLawyerModalOpen:d,editLawyerModalOpen:m},dispatch:r}=M(),{mutate:L,isLoading:w,data:y,error:n,isSuccess:b,isError:h,reset:o}=Se(u,r);return A.useEffect(()=>{(d||m)&&b&&o()},[d,m]),t.jsxs($,{children:[t.jsx(te,{open:s,header:i("entities.addNewLawyer"),children:t.jsx(je,{}),onClose:u,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>L(ge(e)),isLoading:w,hasCloseIconButton:!0}),b&&(y!=null&&y.data.message)?t.jsx(B,{open:l,onClose:()=>r({type:c.openSuccessSnackbar,payload:!1}),severity:"success",content:y==null?void 0:y.data.message}):"",h&&((x=(g=n==null?void 0:n.response)==null?void 0:g.data)!=null&&x.message)?t.jsx(B,{open:p,onClose:()=>r({type:c.openErrorSnackbar,payload:!1}),severity:"error",content:(F=(j=n==null?void 0:n.response)==null?void 0:j.data)==null?void 0:F.message}):""]})},Ee=async(a,s)=>{let u;return u=await T({method:"patch",url:`api/lawyer/${a}`,data:s,withCredentials:!0}),u},ke=(a,s,u)=>{const i=P();return z(e=>Ee(u,e),{onSuccess:e=>(e.data.error||(s({type:c.resetLawyerFormData}),s({type:c.openSuccessSnackbar,payload:!0}),a(),i.invalidateQueries({queryKey:["lawyersList"]}),i.invalidateQueries({queryKey:["lawyer"]})),e.data.message),onError:e=>{var l,p,d,m;return console.error(e),(p=(l=e==null?void 0:e.response)==null?void 0:l.data)!=null&&p.message&&s({type:c.openErrorSnackbar,payload:!0}),{error:e,message:((m=(d=e==null?void 0:e.response)==null?void 0:d.data)==null?void 0:m.message)||"Error has occured"}}})},Ve=async a=>{let s;if(a){try{s=await T({method:"get",url:`api/lawyer/${a}`,withCredentials:!0})}catch{s={data:{error:500,message:"errors.serverError"}}}return s}return{data:{error:400,message:"errors.notFound"}}},Me=a=>K(["lawyer",a],()=>Ve(a),{keepPreviousData:!1,refetchOnMount:!0,refetchOnWindowFocus:!1,select(s){if(s.data.data)return xe(s.data.data)}}),Oe=()=>{const{t:a}=V(),{state:{editLawyerForm:s,editLawyerId:u,editLawyerAutocompleteValues:i},dispatch:e}=M(),{data:l}=se({search:i.city}),{data:p,isLoading:d,isSuccess:m}=Me(u);A.useEffect(()=>{m&&(p!=null&&p.firstName)&&e({type:c.setLawyerFormData,payload:p})},[p==null?void 0:p.firstName]);const r=(y,n,b)=>(h,o)=>{switch(n){case f.input:const{value:g}=h==null?void 0:h.target;let x=g;b?x.match(b)&&e({type:c.editLawyerForm,payload:{editName:y,fieldEditValue:x}}):e({type:c.editLawyerForm,payload:{editName:y,fieldEditValue:x}});break;case f.checkbox:e({type:c.editLawyerForm,payload:{editName:y,fieldEditValue:o}});break;case f.datepicker:e({type:c.editLawyerForm,payload:{editName:y,fieldEditValue:h}});break;case f.dynamicInputs:e({type:c.editLawyerForm,payload:{editName:y,fieldEditValue:h}});break;case f.autocomplete:e({type:c.editLawyerForm,payload:{editName:y,fieldEditValue:o?k(o):""}});break;case f.dynamicAutocompletes:e({type:c.addLawyerForm,payload:{editName:y,fieldEditValue:h.map(j=>k(j))}});break}},L=()=>console.log("Submitted"),w=y=>{const{name:n,type:b,gridClassName:h,formFieldClassName:o,gridWidth:g,size:x,subfieldName:j,format:F,options:v,required:S}=y;switch(b){case f.checkbox:return t.jsx(C,{className:h,item:!0,xs:g||12,children:t.jsx(ee,{required:S,control:t.jsx(ae,{className:o,name:n,size:x??"small",checked:s[n],onChange:r(n,b)}),label:a(`entities.${n}`)})},n);case f.input:return t.jsx(C,{className:h,item:!0,xs:g||12,children:t.jsx(W,{required:S,fullWidth:!0,className:o,size:x??"small",label:a(`entities.${n}`),name:n,value:s[n],onChange:r(n,b,F)})},n);case f.autocomplete:return t.jsx(C,{className:h,item:!0,xs:g||12,children:t.jsx(re,{fullWidth:!0,clearIcon:!1,className:o,options:v??[],getOptionLabel:O=>k(O).name,size:x??"small",value:s[n],onChange:r(n,b),renderInput:O=>t.jsx(W,{...O,required:S,label:a(`entities.${n}`),onBlur:()=>e({type:c.editLawyerAutocompleteValues,payload:{inputName:n,inputValue:""}}),onChange:Z(D=>e({type:c.editLawyerAutocompleteValues,payload:{inputName:n,inputValue:D.target.value}}),300)})})},n);case f.datepicker:return t.jsx(C,{className:h,item:!0,xs:g||12,children:t.jsx(J,{dateAdapter:U,children:t.jsx(X,{localeText:{clearButtonLabel:a("clear")},label:a(`entities.${n}`),value:s[n],className:o,slotProps:{textField:{size:"small",fullWidth:!0,required:S},actionBar:{actions:["clear"]}},format:"DD. MM. YYYY",onChange:r(n,b)})})},n);case f.dynamicInputs:return t.jsx(C,{className:h,item:!0,xs:g||12,children:t.jsx(H,{label:a(`entities.${n}`),inputProps:{label:a(`entities.${j}`),size:"small",fullWidth:!0},values:s[n],onValuesChange:r(n,b)})},n);default:return""}};return d?t.jsx(Y,{className:"flex justify-center items-center h-[300px]",children:t.jsx(pe,{})}):t.jsx($,{children:t.jsx(G,{children:t.jsx("form",{onSubmit:L,children:t.jsx(C,{container:!0,spacing:2,children:ie({citiesOptions:l}).map(y=>w(y))})})})})},Be=async a=>{let s;return s=await T({method:"delete",url:`api/lawyer/${a}`,withCredentials:!0}),s},Ae=(a,s,u)=>{const i=P();return z(()=>Be(u),{onSuccess:e=>(e.data.error||(s({type:c.resetLawyerFormData}),s({type:c.openSuccessSnackbar,payload:!0}),a(),i.invalidateQueries({queryKey:["lawyersList"]})),e.data.message),onError:e=>{var l,p,d,m;return console.error(e),(p=(l=e==null?void 0:e.response)==null?void 0:l.data)!=null&&p.message&&s({type:c.openErrorSnackbar,payload:!0}),{error:e,message:((m=(d=e==null?void 0:e.response)==null?void 0:d.data)==null?void 0:m.message)||"Error has occured"}}})},$e=a=>{var q,I,Q,R;const{open:s,onClose:u}=a,{t:i}=V(),{state:{editedLawyerFormData:e,editLawyerId:l,confirmationDialogOpen:p,openSuccessSnackbar:d,openErrorSnackbar:m,addLawyerModalOpen:r,editLawyerModalOpen:L},dispatch:w}=M(),y=()=>{w({type:c.confirmationDialogOpen,payload:!1}),u()},{mutate:n,isLoading:b,data:h,error:o,isSuccess:g,isError:x,reset:j}=ke(u,w,l),{mutate:F,isLoading:v,data:S,error:O,isSuccess:D,isError:oe,reset:ne}=Ae(y,w,l);A.useEffect(()=>{(r||L)&&(g&&j(),D&&ne())},[r,L]);const le=x||oe,E=o||O;return t.jsxs($,{children:[t.jsx(te,{open:s,header:i("entities.editLawyer"),children:t.jsx(Oe,{}),onClose:u,hasActionButton:!0,actionButtonText:"submit",hasCancelButton:!0,onSubmit:()=>n(Le(e)),isLoading:b,hasCloseIconButton:!0,extraButtonText:"delete",hasExtraButton:!0,onExtraButtonClick:()=>w({type:c.confirmationDialogOpen,payload:!p})}),t.jsx(me,{title:"entities.deleteLawyer",isLoading:v,open:p,onClose:()=>y(),onSubmit:()=>F()}),g&&(h!=null&&h.data.message)?t.jsx(B,{open:d,onClose:()=>w({type:c.openSuccessSnackbar,payload:!1}),severity:"success",content:h==null?void 0:h.data.message}):"",D&&(S!=null&&S.data.message)?t.jsx(B,{open:d,onClose:()=>w({type:c.openSuccessSnackbar,payload:!1}),severity:"success",content:S==null?void 0:S.data.message}):"",le&&((I=(q=E==null?void 0:E.response)==null?void 0:q.data)!=null&&I.message)?t.jsx(B,{open:m,onClose:()=>w({type:c.openErrorSnackbar,payload:!1}),severity:"error",content:(R=(Q=E==null?void 0:E.response)==null?void 0:Q.data)==null?void 0:R.message}):""]})},ze=a=>{const{t:s}=V(),{state:{addLawyerModalOpen:u,editLawyerModalOpen:i},dispatch:e}=M(),l=()=>{e({type:c.addLawyerModalOpen,payload:!1}),e({type:c.resetLawyerFormData})},p=()=>{e({type:c.editLawyerModalOpen,payload:!1}),e({type:c.resetLawyerFormData})};return t.jsx($,{children:t.jsxs(A.Suspense,{fallback:"Loading....",children:[t.jsx(Y,{className:"my-2 flex justify-end",children:t.jsx(ye,{onClick:()=>e({type:c.addLawyerModalOpen,payload:!u}),children:s("entities.addNewLawyer")})}),t.jsx(Ne,{}),t.jsx(Fe,{open:u,onClose:l}),t.jsx($e,{open:i,onClose:p})]})})};export{ze as Lawyers};
